<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zo2y — Movies</title>
  <link rel="icon" href="/favicon.ico?v=3" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>
  <style>
    :root {
      --bg: #0b1633;
      --card: #132347;
      --accent: #f59e0b;
      --text: #ffffff;
      --muted: #9fb0cf;
      --border: rgba(255,255,255,0.08);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(11, 22, 51, 0.9);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }

    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 14px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 18px;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor: pointer;
      text-decoration: none;
      font-size: 14px;
      transition: all 0.2s ease;
    }

    .btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .hero {
      max-width: 1200px;
      margin: 24px auto 0;
      padding: 0 20px;
    }

    .hero h1 {
      font-size: 28px;
      margin: 0 0 8px 0;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
    }

    .grid {
      max-width: 1200px;
      margin: 24px auto 60px;
      padding: 0 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 320px;
      transition: all 0.2s ease;
    }

    .card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .card img {
      width: 100%;
      height: 260px;
      object-fit: cover;
      background: #0f1f40;
    }

    .card-body {
      padding: 12px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      margin: 0;
    }

    .card-meta {
      font-size: 12px;
      color: var(--muted);
    }

    .card-desc {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 60px;
    }

    .empty {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      color: var(--muted);
      text-align: center;
    }

    @media (max-width: 600px) {
      .header-inner { padding: 12px 16px; }
      .hero h1 { font-size: 22px; }
      .grid { gap: 12px; }
      .card img { height: 220px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-title"><i class="fas fa-film"></i> Movies</div>
      <div class="header-actions">
        <a class="btn" href="index.html"><i class="fas fa-home"></i> Home</a>
        <a class="btn" href="restraunts.html"><i class="fas fa-utensils"></i> Restaurants</a>
      </div>
    </div>
  </header>

  <section class="hero">
    <h1>Popular Movies</h1>
    <p>Egyptian-focused content sourced from TMDB and cached in Supabase.</p>
  </section>

  <div id="moviesGrid" class="grid"></div>
  <div id="emptyState" class="empty" style="display:none;">No movies found.</div>

  <script>
    (function () {
      const SUPABASE_URL = 'https://gfkhjbztayjyojsgdpgk.supabase.co';
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdma2hqYnp0YXlqeW9qc2dkcGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTYyNjQsImV4cCI6MjA3NTY3MjI2NH0.WUb2yDAwCeokdpWCPeH13FE8NhWF6G8e6ivTsgu6b2s';
      let supabase;

      function initSupabase() {
        if (window.supabase && window.supabase.createClient) {
          supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
          return true;
        }
        return false;
      }

      async function loadMovies() {
        const grid = document.getElementById('moviesGrid');
        const empty = document.getElementById('emptyState');
        if (!grid) return;

        const { data, error } = await supabase
          .from('content')
          .select('name, description, image_url, release_date, category')
          .eq('type', 'movie')
          .order('release_date', { ascending: false })
          .limit(60);

        if (error || !data || data.length === 0) {
          if (empty) empty.style.display = 'block';
          return;
        }

        const fragment = document.createDocumentFragment();
        data.forEach(item => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${item.image_url || 'images/placeholder.jpg'}" alt="${item.name}">
            <div class="card-body">
              <h3 class="card-title">${item.name}</h3>
              <div class="card-meta">${item.release_date || ''} ${item.category ? '• ' + item.category : ''}</div>
              <div class="card-desc">${item.description || 'No description available.'}</div>
            </div>
          `;
          fragment.appendChild(card);
        });
        grid.innerHTML = '';
        grid.appendChild(fragment);
      }

      const wait = setInterval(() => {
        if (initSupabase()) {
          clearInterval(wait);
          loadMovies();
        }
      }, 50);
    })();
  </script>
</body>
</html>
