<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Zo2y — Movie</title>
  <link rel="icon" href="/favicon.ico?v=3" type="image/x-icon" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    :root {
      --bg: #0b1633;
      --card: #132347;
      --accent: #f59e0b;
      --text: #ffffff;
      --muted: #9fb0cf;
      --border: rgba(255,255,255,0.08);
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); }
    header { position: sticky; top: 0; z-index: 10; background: rgba(11,22,51,0.9); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); }
    .header-inner { max-width: 1200px; margin: 0 auto; padding: 14px 20px; display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .header-title { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 18px; }
    .header-actions { display: flex; gap: 10px; }
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--card); color: var(--text); cursor: pointer; text-decoration: none; font-size: 14px; transition: all 0.2s ease; }
    .btn:hover { border-color: var(--accent); color: var(--accent); }
    .wrap { max-width: 1200px; margin: 24px auto 60px; padding: 0 20px; display: grid; grid-template-columns: 320px 1fr; gap: 24px; }
    .poster { width: 100%; border-radius: 14px; border: 1px solid var(--border); background: #0f1f40; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 14px; padding: 20px; }
    .title { margin: 0 0 8px; font-size: 28px; }
    .meta { color: var(--muted); font-size: 14px; margin-bottom: 16px; }
    .overview { line-height: 1.6; color: var(--muted); }
    .section-title { margin: 20px 0 8px; font-size: 16px; }
    .people-list { display: flex; flex-wrap: wrap; gap: 8px; }
    .person-chip { padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); font-size: 12px; }
    .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-top: 10px; }
    .meta-item { background: #0f1f40; border: 1px solid var(--border); border-radius: 10px; padding: 10px; font-size: 12px; color: var(--muted); }
    .tag { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border); color: var(--muted); font-size: 12px; margin-right: 8px; }
    .video-frame { width: 100%; aspect-ratio: 16 / 9; border: 0; border-radius: 12px; background: #0f1f40; }
    .list-stack { display: grid; gap: 6px; }
    .list-row { display: flex; gap: 8px; align-items: baseline; color: var(--muted); font-size: 12px; }
    .list-label { color: var(--text); font-weight: 600; }
    @media (max-width: 900px) { .wrap { grid-template-columns: 1fr; } .poster { max-width: 360px; } }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-title"><i class="fas fa-film"></i> Movie Details</div>
      <div class="header-actions">
        <a class="btn" href="movies.html"><i class="fas fa-arrow-left"></i> Back</a>
        <a class="btn" href="index.html"><i class="fas fa-home"></i> Home</a>
        <a class="btn" href="profile.html"><i class="fas fa-user"></i> Profile</a>
      </div>
    </div>
  </header>

  <div class="wrap">
    <img id="poster" class="poster" src="images/placeholder.jpg" alt="Poster">
    <div class="card">
      <h1 id="title" class="title">Loading...</h1>
      <div id="meta" class="meta"></div>
      <div id="tags"></div>
      <p id="overview" class="overview"></p>
      <div class="meta-grid" id="metaGrid"></div>
      <h3 class="section-title">Details</h3>
      <div id="details" class="list-stack"></div>
      <h3 class="section-title">Trailer</h3>
      <div id="trailer"></div>
      <h3 class="section-title">Director</h3>
      <div id="directors" class="people-list"></div>
      <h3 class="section-title">Writers</h3>
      <div id="writers" class="people-list"></div>
      <h3 class="section-title">Cast</h3>
      <div id="cast" class="people-list"></div>
    </div>
  </div>

  <script>
    (function () {
      const TMDB_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiI4NzVjMDM5N2IxZGUxYzU3NjQ4ZmRiNjJiZGQ5NmI0OSIsIm5iZiI6MTc3MDU4Mzk1NC42NTc5OTk4LCJzdWIiOiI2OTg4Zjc5MmFlYTFkN2NjNjcyY2VlNDciLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.1RMWLft0Yl73gfhkCXtnqBIzRQHdaoLfZFYXYN7jm7s';
      const TMDB_BASE = 'https://api.themoviedb.org/3';
      const POSTER_BASE = 'https://image.tmdb.org/t/p/w500';
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');

      async function tmdbFetch(path) {
        const res = await fetch(TMDB_BASE + path, {
          headers: { Authorization: `Bearer ${TMDB_TOKEN}` }
        });
        if (!res.ok) throw new Error('TMDB error');
        return res.json();
      }

      async function loadOld() {
        if (!id) return;
        const [data, credits] = await Promise.all([
          tmdbFetch(`/movie/${id}?language=en`),
          tmdbFetch(`/movie/${id}/credits?language=en`)
        ]);
        document.getElementById('title').textContent = data.title || 'Untitled';
        document.getElementById('overview').textContent = data.overview || 'No description available.';
        document.getElementById('meta').textContent = `${data.release_date || ''} • ${data.runtime || ''} min`;
        document.getElementById('poster').src = data.poster_path ? POSTER_BASE + data.poster_path : 'images/placeholder.jpg';
        const tags = document.getElementById('tags');
        if (tags && Array.isArray(data.genres)) {
          tags.innerHTML = data.genres.map(g => `<span class="tag">${g.name}</span>`).join('');
        }
        const metaGrid = document.getElementById('metaGrid');
        if (metaGrid) {
          const items = [];
          if (data.original_language) items.push(`Language: ${data.original_language.toUpperCase()}`);
          if (data.status) items.push(`Status: ${data.status}`);
          if (data.budget) items.push(`Budget: $${data.budget.toLocaleString()}`);
          if (data.revenue) items.push(`Revenue: $${data.revenue.toLocaleString()}`);
          metaGrid.innerHTML = items.map(i => `<div class="meta-item">${i}</div>`).join('');
        }
        const directors = (credits.crew || []).filter(p => p.job === 'Director').slice(0, 3);
        const cast = (credits.cast || []).slice(0, 12);
        const directorsEl = document.getElementById('directors');
        if (directorsEl) {
          directorsEl.innerHTML = directors.length ? directors.map(p => `<span class="person-chip">${p.name}</span>`).join('') : '<span class="person-chip">N/A</span>';
        }
        const castEl = document.getElementById('cast');
        if (castEl) {
          castEl.innerHTML = cast.length ? cast.map(p => `<span class="person-chip">${p.name}</span>`).join('') : '<span class="person-chip">N/A</span>';
        }
      }

      async function load() {
        if (!id) return;
        const [data, credits, videos, keywords, externals] = await Promise.all([
          tmdbFetch(`/movie/${id}?language=en`),
          tmdbFetch(`/movie/${id}/credits?language=en`),
          tmdbFetch(`/movie/${id}/videos?language=en`),
          tmdbFetch(`/movie/${id}/keywords`),
          tmdbFetch(`/movie/${id}/external_ids`)
        ]);
        document.getElementById('title').textContent = data.title || 'Untitled';
        document.getElementById('overview').textContent = data.overview || 'No description available.';
        document.getElementById('meta').textContent = `${data.release_date || ''} • ${data.runtime || ''} min`;
        document.getElementById('poster').src = data.poster_path ? POSTER_BASE + data.poster_path : 'images/placeholder.jpg';
        const tags = document.getElementById('tags');
        if (tags && Array.isArray(data.genres)) {
          tags.innerHTML = data.genres.map(g => `<span class="tag">${g.name}</span>`).join('');
        }
        const metaGrid = document.getElementById('metaGrid');
        if (metaGrid) {
          const items = [];
          if (data.original_language) items.push(`Language: ${data.original_language.toUpperCase()}`);
          if (data.status) items.push(`Status: ${data.status}`);
          if (typeof data.vote_average === 'number') items.push(`Rating: ${data.vote_average.toFixed(1)} (${data.vote_count || 0})`);
          if (typeof data.popularity === 'number') items.push(`Popularity: ${Math.round(data.popularity)}`);
          if (data.budget) items.push(`Budget: $${data.budget.toLocaleString()}`);
          if (data.revenue) items.push(`Revenue: $${data.revenue.toLocaleString()}`);
          metaGrid.innerHTML = items.map(i => `<div class="meta-item">${i}</div>`).join('');
        }
        const detailsEl = document.getElementById('details');
        if (detailsEl) {
          const detailRows = [];
          if (data.tagline) detailRows.push(`<div class="list-row"><span class="list-label">Tagline:</span> ${data.tagline}</div>`);
          if (Array.isArray(data.production_companies) && data.production_companies.length) {
            detailRows.push(`<div class="list-row"><span class="list-label">Studios:</span> ${data.production_companies.map(c => c.name).join(', ')}</div>`);
          }
          if (Array.isArray(data.production_countries) && data.production_countries.length) {
            detailRows.push(`<div class="list-row"><span class="list-label">Countries:</span> ${data.production_countries.map(c => c.name).join(', ')}</div>`);
          }
          if (Array.isArray(data.spoken_languages) && data.spoken_languages.length) {
            detailRows.push(`<div class="list-row"><span class="list-label">Languages:</span> ${data.spoken_languages.map(l => l.english_name || l.name).join(', ')}</div>`);
          }
          if (externals && externals.imdb_id) {
            detailRows.push(`<div class="list-row"><span class="list-label">IMDB:</span> <a class="tag" href="https://www.imdb.com/title/${externals.imdb_id}/" target="_blank" rel="noopener">Open</a></div>`);
          }
          const keywordList = (keywords.keywords || []).slice(0, 8).map(k => k.name);
          if (keywordList.length) {
            detailRows.push(`<div class="list-row"><span class="list-label">Keywords:</span> ${keywordList.join(', ')}</div>`);
          }
          detailsEl.innerHTML = detailRows.length ? detailRows.join('') : '<div class="list-row">No extra details available.</div>';
        }
        const trailerEl = document.getElementById('trailer');
        if (trailerEl) {
          const trailer = (videos.results || []).find(v => v.site === 'YouTube' && (v.type === 'Trailer' || v.type === 'Teaser'));
          trailerEl.innerHTML = trailer
            ? `<iframe class="video-frame" src="https://www.youtube.com/embed/${trailer.key}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`
            : '<div class="meta-item">No trailer available.</div>';
        }
        const directors = (credits.crew || []).filter(p => p.job === 'Director').slice(0, 3);
        const writers = (credits.crew || []).filter(p => ['Writer', 'Screenplay', 'Story'].includes(p.job)).slice(0, 6);
        const cast = (credits.cast || []).slice(0, 12);
        const directorsEl = document.getElementById('directors');
        if (directorsEl) {
          directorsEl.innerHTML = directors.length ? directors.map(p => `<span class="person-chip">${p.name}</span>`).join('') : '<span class="person-chip">N/A</span>';
        }
        const writersEl = document.getElementById('writers');
        if (writersEl) {
          writersEl.innerHTML = writers.length ? writers.map(p => `<span class="person-chip">${p.name}</span>`).join('') : '<span class="person-chip">N/A</span>';
        }
        const castEl = document.getElementById('cast');
        if (castEl) {
          castEl.innerHTML = cast.length ? cast.map(p => `<span class="person-chip">${p.name}${p.character ? ` as ${p.character}` : ''}</span>`).join('') : '<span class="person-chip">N/A</span>';
        }
      }

      load();
    })();
  </script>
</body>
</html>
