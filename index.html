<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zo2y — Discover Local Favorites</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="images/logo.png">
    
    <!-- Core Styles -->
    <style>
        /* === CSS Reset & Variables === */
        :root {
            /* Color Palette */
            --bg: #0b1633;
            --card: #132347;
            --muted: #8ca3c7;
            --accent: #f59e0b;
            --accent-light: #ffb84d;
            --glass: rgba(255,255,255,0.03);
            --white: #ffffff;
            --border: rgba(255,255,255,0.1);
            --gradient: linear-gradient(135deg, #f59e0b 0%, #ffb84d 100%);
            --gradient-dark: linear-gradient(135deg, #0b1633 0%, #132347 100%);
            --shadow: 0 10px 30px rgba(0,0,0,0.3);
            --shadow-light: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-heavy: 0 20px 50px rgba(0,0,0,0.5);
            --success: #10b981;
            --error: #ef4444;
            --info: #3b82f6;
            --warning: #f59e0b;
            --surface: rgba(19, 35, 71, 0.6);
            --overlay: rgba(11, 22, 51, 0.95);
            
            /* Typography */
            --font-primary: 'Inter', system-ui, -apple-system, sans-serif;
            --text-xs: 0.75rem;   /* 12px */
            --text-sm: 0.875rem;  /* 14px */
            --text-base: 1rem;    /* 16px */
            --text-lg: 1.125rem;  /* 18px */
            --text-xl: 1.25rem;   /* 20px */
            --text-2xl: 1.5rem;   /* 24px */
            --text-3xl: 1.875rem; /* 30px */
            --text-4xl: 2.25rem;  /* 36px */
            --text-5xl: 3rem;     /* 48px */
            
            /* Spacing */
            --space-1: 0.25rem;   /* 4px */
            --space-2: 0.5rem;    /* 8px */
            --space-3: 0.75rem;   /* 12px */
            --space-4: 1rem;      /* 16px */
            --space-6: 1.5rem;    /* 24px */
            --space-8: 2rem;      /* 32px */
            --space-12: 3rem;     /* 48px */
            --space-16: 4rem;     /* 64px */
            
            /* Border Radius */
            --radius-sm: 0.375rem;  /* 6px */
            --radius-md: 0.75rem;   /* 12px */
            --radius-lg: 1rem;      /* 16px */
            --radius-xl: 1.5rem;    /* 24px */
            --radius-full: 9999px;
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 300ms ease;
            --transition-slow: 500ms ease;
            
            /* Z-index layers */
            --z-dropdown: 10;
            --z-sticky: 20;
            --z-fixed: 30;
            --z-modal: 40;
            --z-popover: 50;
            --z-tooltip: 60;
            --z-toast: 70;
        }
        
        /* Reset & Base Styles */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--bg);
            color: var(--white);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }
        
        /* Typography */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: var(--space-4);
        }
        
        h1 { font-size: clamp(2rem, 5vw, 3.5rem); }
        h2 { font-size: clamp(1.5rem, 4vw, 2.5rem); }
        h3 { font-size: clamp(1.25rem, 3vw, 2rem); }
        h4 { font-size: clamp(1.125rem, 2.5vw, 1.5rem); }
        
        p { margin-bottom: var(--space-4); }
        
        a {
            color: inherit;
            text-decoration: none;
            transition: color var(--transition-fast);
        }
        
        a:hover {
            color: var(--accent);
        }
        
        img {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        button, input, textarea, select {
            font: inherit;
            color: inherit;
            background: none;
            border: none;
            outline: none;
        }
        
        button {
            cursor: pointer;
            user-select: none;
        }
        
        ul, ol {
            list-style: none;
        }
        
        /* Utility Classes */
        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-right { text-align: right; }
        
        .text-accent { color: var(--accent); }
        .text-muted { color: var(--muted); }
        .text-success { color: var(--success); }
        .text-error { color: var(--error); }
        
        .bg-gradient { background: var(--gradient); }
        .bg-card { background: var(--card); }
        .bg-surface { background: var(--surface); }
        
        .glass {
            background: var(--glass);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .shadow { box-shadow: var(--shadow); }
        .shadow-light { box-shadow: var(--shadow-light); }
        .shadow-heavy { box-shadow: var(--shadow-heavy); }
        
        .rounded-sm { border-radius: var(--radius-sm); }
        .rounded-md { border-radius: var(--radius-md); }
        .rounded-lg { border-radius: var(--radius-lg); }
        .rounded-xl { border-radius: var(--radius-xl); }
        .rounded-full { border-radius: var(--radius-full); }
        
        .border { border: 1px solid var(--border); }
        .border-accent { border: 1px solid var(--accent); }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .hidden { display: none !important; }
        
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .items-end { align-items: flex-end; }
        .items-stretch { align-items: stretch; }
        
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-start { justify-content: flex-start; }
        .justify-end { justify-content: flex-end; }
        
        .flex-col { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .flex-wrap { flex-wrap: wrap; }
        .flex-nowrap { flex-wrap: nowrap; }
        
        .gap-1 { gap: var(--space-1); }
        .gap-2 { gap: var(--space-2); }
        .gap-3 { gap: var(--space-3); }
        .gap-4 { gap: var(--space-4); }
        .gap-6 { gap: var(--space-6); }
        .gap-8 { gap: var(--space-8); }
        
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        
        .p-2 { padding: var(--space-2); }
        .p-3 { padding: var(--space-3); }
        .p-4 { padding: var(--space-4); }
        .p-6 { padding: var(--space-6); }
        .p-8 { padding: var(--space-8); }
        
        .px-2 { padding-left: var(--space-2); padding-right: var(--space-2); }
        .px-3 { padding-left: var(--space-3); padding-right: var(--space-3); }
        .px-4 { padding-left: var(--space-4); padding-right: var(--space-4); }
        .px-6 { padding-left: var(--space-6); padding-right: var(--space-6); }
        
        .py-2 { padding-top: var(--space-2); padding-bottom: var(--space-2); }
        .py-3 { padding-top: var(--space-3); padding-bottom: var(--space-3); }
        .py-4 { padding-top: var(--space-4); padding-bottom: var(--space-4); }
        .py-6 { padding-top: var(--space-6); padding-bottom: var(--space-6); }
        
        .mt-2 { margin-top: var(--space-2); }
        .mt-4 { margin-top: var(--space-4); }
        .mt-6 { margin-top: var(--space-6); }
        .mt-8 { margin-top: var(--space-8); }
        
        .mb-2 { margin-bottom: var(--space-2); }
        .mb-4 { margin-bottom: var(--space-4); }
        .mb-6 { margin-bottom: var(--space-6); }
        .mb-8 { margin-bottom: var(--space-8); }
        
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .sticky { position: sticky; }
        
        .top-0 { top: 0; }
        .right-0 { right: 0; }
        .bottom-0 { bottom: 0; }
        .left-0 { left: 0; }
        
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        
        .overflow-hidden { overflow: hidden; }
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .cursor-pointer { cursor: pointer; }
        .cursor-default { cursor: default; }
        
        .transition { transition: all var(--transition-base); }
        .transition-fast { transition: all var(--transition-fast); }
        .transition-slow { transition: all var(--transition-slow); }
        
        .hover\:scale-105:hover { transform: scale(1.05); }
        .hover\:scale-110:hover { transform: scale(1.1); }
        .hover\:-translate-y-1:hover { transform: translateY(-0.25rem); }
        .hover\:-translate-y-2:hover { transform: translateY(-0.5rem); }
        
        .active\:scale-95:active { transform: scale(0.95); }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px var(--accent); }
            50% { box-shadow: 0 0 20px var(--accent); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .animate-fadeIn { animation: fadeIn 0.5s ease; }
        .animate-slideInUp { animation: slideInUp 0.5s ease; }
        .animate-slideInDown { animation: slideInDown 0.5s ease; }
        .animate-slideInLeft { animation: slideInLeft 0.5s ease; }
        .animate-slideInRight { animation: slideInRight 0.5s ease; }
        .animate-pulse { animation: pulse 2s infinite; }
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        
        /* === COMPONENT STYLES === */
        
        /* Container */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--space-4);
        }
        
        /* Header & Navigation */
        .header {
            position: sticky;
            top: 0;
            z-index: var(--z-sticky);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            transition: all var(--transition-base);
        }
        
        .header.scrolled {
            background: var(--overlay);
            box-shadow: var(--shadow);
        }
        
        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) 0;
            gap: var(--space-4);
        }
        
        .logo {
            height: 40px;
            cursor: pointer;
            transition: transform var(--transition-base);
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        /* Search */
        .search-wrapper {
            flex: 1;
            max-width: 500px;
            position: relative;
        }
        
        .search {
            width: 100%;
            padding: var(--space-3) var(--space-4) var(--space-3) var(--space-12);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            color: var(--white);
            font-size: var(--text-sm);
            transition: all var(--transition-base);
        }
        
        .search:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
            pointer-events: none;
        }
        
        .clear-search {
            position: absolute;
            right: var(--space-4);
            top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
            background: none;
            border: none;
            cursor: pointer;
            display: none;
        }
        
        .clear-search:hover {
            color: var(--white);
        }
        
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            margin-top: var(--space-2);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            z-index: var(--z-dropdown);
            box-shadow: var(--shadow);
        }
        
        .search-suggestions.show {
            display: block;
            animation: slideInDown 0.3s ease;
        }
        
        .suggestion-item {
            padding: var(--space-3) var(--space-4);
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: background-color var(--transition-fast);
        }
        
        .suggestion-item:last-child {
            border-bottom: none;
        }
        
        .suggestion-item:hover {
            background-color: var(--glass);
        }
        
        .suggestion-name {
            font-weight: 500;
            font-size: var(--text-sm);
            margin-bottom: var(--space-1);
        }
        
        .suggestion-category {
            font-size: var(--text-xs);
            color: var(--muted);
        }
        
        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            font-weight: 500;
            font-size: var(--text-sm);
            transition: all var(--transition-base);
            white-space: nowrap;
        }
        
        .btn-primary {
            background: var(--gradient);
            color: var(--bg);
            font-weight: 600;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .btn-secondary {
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--white);
        }
        
        .btn-secondary:hover {
            background: var(--glass);
            border-color: var(--accent);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--white);
        }
        
        .btn-outline:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .btn-ghost {
            background: transparent;
            color: var(--muted);
        }
        
        .btn-ghost:hover {
            color: var(--accent);
            background: rgba(245, 158, 11, 0.1);
        }
        
        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            border-radius: var(--radius-md);
        }
        
        /* Guest Banner */
        .guest-banner {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(255, 184, 77, 0.1) 100%);
            border: 1px solid rgba(245, 158, 11, 0.2);
            border-radius: var(--radius-md);
            padding: var(--space-3) var(--space-4);
            margin: var(--space-4) auto;
            max-width: 1200px;
            display: none;
            animation: slideInDown 0.3s ease;
        }
        
        .guest-banner.show {
            display: block;
        }
        
        .banner-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-4);
        }
        
        .banner-text {
            color: var(--muted);
            font-size: var(--text-sm);
        }
        
        /* Hero Section */
        .hero {
            position: relative;
            min-height: 80vh;
            display: flex;
            align-items: center;
            overflow: hidden;
        }
        
        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-dark);
            z-index: -2;
        }
        
        .hero-pattern {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(circle at 20% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                            radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
            z-index: -1;
        }
        
        .hero-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-8);
            align-items: center;
        }
        
        @media (min-width: 768px) {
            .hero-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .hero-tag {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            border: 1px solid rgba(245, 158, 11, 0.2);
            font-size: var(--text-sm);
            font-weight: 600;
            margin-bottom: var(--space-6);
        }
        
        .hero-title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            line-height: 1.1;
            margin-bottom: var(--space-4);
            background: linear-gradient(135deg, var(--white) 0%, var(--muted) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            color: var(--muted);
            font-size: clamp(1rem, 2vw, 1.25rem);
            line-height: 1.6;
            margin-bottom: var(--space-6);
            max-width: 500px;
        }
        
        .hero-actions {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }
        
        .hero-stats {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-6);
        }
        
        .stat {
            display: flex;
            flex-direction: column;
        }
        
        .stat-number {
            font-size: var(--text-3xl);
            font-weight: 800;
            color: var(--accent);
            line-height: 1;
        }
        
        .stat-label {
            font-size: var(--text-sm);
            color: var(--muted);
        }
        
        /* Spotlight */
        .spotlight-wrapper {
            position: relative;
            perspective: 1000px;
        }
        
        .spotlight {
            background: var(--card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            border: 2px solid var(--border);
            transform-style: preserve-3d;
            transition: all var(--transition-base);
            height: 400px;
            position: relative;
        }
        
        .spotlight:hover {
            transform: translateY(-10px) rotateX(5deg);
            border-color: var(--accent);
            box-shadow: var(--shadow-heavy);
        }
        
        .spotlight-image {
            width: 100%;
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .spotlight-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }
        
        .spotlight:hover .spotlight-image img {
            transform: scale(1.1);
        }
        
        .spotlight-badge {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            background: var(--gradient);
            color: var(--bg);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            z-index: 2;
        }
        
        .spotlight-content {
            padding: var(--space-6);
            position: relative;
            z-index: 2;
        }
        
        .spotlight-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }
        
        .spotlight-title {
            font-size: var(--text-xl);
            font-weight: 700;
            margin-bottom: var(--space-2);
        }
        
        .spotlight-rating {
            background: rgba(245, 158, 11, 0.1);
            color: var(--accent);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .spotlight-description {
            color: var(--muted);
            font-size: var(--text-sm);
            line-height: 1.6;
            margin-bottom: var(--space-4);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .spotlight-actions {
            display: flex;
            gap: var(--space-3);
        }
        
        /* Sections */
        .section {
            padding: var(--space-12) 0;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: var(--space-8);
            flex-wrap: wrap;
            gap: var(--space-4);
        }
        
        .section-title {
            position: relative;
            padding-bottom: var(--space-3);
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--gradient);
            border-radius: var(--radius-full);
        }
        
        .section-subtitle {
            color: var(--muted);
            font-size: var(--text-lg);
            margin-top: var(--space-2);
            max-width: 600px;
        }
        
        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: var(--space-2);
            overflow-x: auto;
            padding: var(--space-2) 0;
            margin-bottom: var(--space-6);
            scrollbar-width: none;
        }
        
        .filter-bar::-webkit-scrollbar {
            display: none;
        }
        
        .filter-btn {
            padding: var(--space-2) var(--space-4);
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius-full);
            color: var(--muted);
            font-size: var(--text-sm);
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .filter-btn.active {
            background: var(--gradient);
            border-color: var(--accent);
            color: var(--bg);
            font-weight: 600;
        }
        
        /* Restaurant Cards */
        .restaurant-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-8);
        }
        
        @media (max-width: 768px) {
            .restaurant-grid {
                grid-template-columns: 1fr;
                gap: var(--space-4);
            }
        }
        
        .restaurant-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all var(--transition-base);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .restaurant-card:hover {
            transform: translateY(-8px);
            border-color: var(--accent);
            box-shadow: var(--shadow);
        }
        
        .card-image {
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-slow);
        }
        
        .restaurant-card:hover .card-image img {
            transform: scale(1.1);
        }
        
        .card-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, transparent 0%, rgba(11, 22, 51, 0.8) 100%);
        }
        
        .card-badges {
            position: absolute;
            top: var(--space-3);
            left: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            z-index: 2;
        }
        
        .card-badge {
            background: rgba(11, 22, 51, 0.9);
            color: var(--accent);
            padding: var(--space-2) var(--space-3);
            border-radius: var(--radius-md);
            font-size: var(--text-xs);
            font-weight: 600;
            border: 1px solid var(--accent);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: var(--space-1);
            white-space: nowrap;
        }
        
        .card-badge i {
            font-size: var(--text-sm);
        }
        
        .card-actions {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            display: flex;
            gap: var(--space-2);
            z-index: 2;
        }
        
        .card-action-btn {
            width: 36px;
            height: 36px;
            background: rgba(11, 22, 51, 0.9);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            backdrop-filter: blur(10px);
        }
        
        .card-action-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
            transform: scale(1.1);
        }
        
        .card-content {
            padding: var(--space-4);
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }
        
        .card-title {
            font-size: var(--text-lg);
            font-weight: 700;
            line-height: 1.3;
            flex: 1;
        }
        
        .card-rating {
            background: var(--gradient);
            color: var(--bg);
            padding: var(--space-1) var(--space-3);
            border-radius: var(--radius-full);
            font-size: var(--text-sm);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: var(--space-1);
            white-space: nowrap;
            flex-shrink: 0;
        }
        
        .card-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }
        
        .card-category {
            color: var(--accent);
            font-size: var(--text-sm);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .card-location {
            color: var(--muted);
            font-size: var(--text-sm);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .card-description {
            color: var(--muted);
            font-size: var(--text-sm);
            line-height: 1.5;
            margin-bottom: var(--space-4);
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--space-4);
            border-top: 1px solid var(--border);
            margin-top: auto;
        }
        
        .card-price {
            color: var(--white);
            font-weight: 600;
            font-size: var(--text-sm);
        }
        
        .card-distance {
            color: var(--muted);
            font-size: var(--text-xs);
        }
        
        /* Mobile Carousel */
        .carousel-container {
            position: relative;
            margin: 0 calc(-1 * var(--space-4));
            padding: 0 var(--space-4);
        }
        
        .carousel-track {
            display: flex;
            gap: var(--space-4);
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            scroll-behavior: smooth;
            padding: var(--space-2) 0;
            scrollbar-width: none;
        }
        
        .carousel-track::-webkit-scrollbar {
            display: none;
        }
        
        .carousel-card {
            flex: 0 0 300px;
            scroll-snap-align: start;
        }
        
        .carousel-nav {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            margin-top: var(--space-4);
        }
        
        .carousel-dot {
            width: 8px;
            height: 8px;
            border-radius: var(--radius-full);
            background: var(--border);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .carousel-dot.active {
            background: var(--accent);
            width: 24px;
        }
        
        /* Restaurant of the Day */
        .restaurant-of-day {
            background: linear-gradient(135deg, var(--card) 0%, rgba(19, 35, 71, 0.8) 100%);
            border-radius: var(--radius-xl);
            overflow: hidden;
            position: relative;
            margin: var(--space-12) 0;
        }
        
        .day-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, rgba(245, 158, 11, 0.1) 0%, rgba(59, 130, 246, 0.1) 100%);
            z-index: 1;
        }
        
        .day-content {
            position: relative;
            z-index: 2;
            padding: var(--space-8);
        }
        
        .day-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        
        .day-title {
            font-size: var(--text-4xl);
            margin-bottom: var(--space-4);
            position: relative;
            display: inline-block;
        }
        
        .day-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: var(--gradient);
            border-radius: var(--radius-full);
        }
        
        .day-subtitle {
            color: var(--muted);
            font-size: var(--text-lg);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .day-card {
            background: var(--bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 2px solid var(--border);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .day-card-image {
            height: 300px;
            position: relative;
        }
        
        .day-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .day-card-badge {
            position: absolute;
            top: var(--space-4);
            left: var(--space-4);
            background: var(--gradient);
            color: var(--bg);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-md);
            font-size: var(--text-sm);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            z-index: 2;
        }
        
        .day-card-content {
            padding: var(--space-6);
        }
        
        .day-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-4);
        }
        
        .day-card-title {
            font-size: var(--text-2xl);
            font-weight: 800;
        }
        
        .day-card-rating {
            background: var(--gradient);
            color: var(--bg);
            padding: var(--space-2) var(--space-4);
            border-radius: var(--radius-full);
            font-size: var(--text-lg);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }
        
        .day-card-meta {
            display: flex;
            gap: var(--space-4);
            margin-bottom: var(--space-4);
        }
        
        .day-card-description {
            color: var(--muted);
            font-size: var(--text-base);
            line-height: 1.6;
            margin-bottom: var(--space-6);
        }
        
        .day-card-actions {
            display: flex;
            gap: var(--space-4);
        }
        
        /* App Download */
        .app-download {
            background: var(--card);
            border-radius: var(--radius-xl);
            padding: var(--space-8);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .app-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, rgba(245, 158, 11, 0.1) 0%, transparent 50%),
                      radial-gradient(circle at 70% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
            z-index: 1;
        }
        
        .app-content {
            position: relative;
            z-index: 2;
        }
        
        .app-title {
            font-size: var(--text-3xl);
            margin-bottom: var(--space-4);
        }
        
        .app-subtitle {
            color: var(--muted);
            font-size: var(--text-lg);
            max-width: 600px;
            margin: 0 auto var(--space-6);
        }
        
        .app-buttons {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            flex-wrap: wrap;
        }
        
        .app-button {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            padding: var(--space-4) var(--space-6);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--white);
            transition: all var(--transition-base);
        }
        
        .app-button:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
            transform: translateY(-2px);
        }
        
        .app-button-icon {
            font-size: var(--text-2xl);
        }
        
        .app-button-text {
            text-align: left;
        }
        
        .app-button-text span:first-child {
            font-size: var(--text-xs);
            color: var(--muted);
        }
        
        .app-button-text span:last-child {
            font-size: var(--text-lg);
            font-weight: 600;
        }
        
        /* Footer */
        .footer {
            background: var(--card);
            border-top: 1px solid var(--border);
            padding: var(--space-12) 0 var(--space-8);
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-8);
            margin-bottom: var(--space-8);
        }
        
        .footer-column {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .footer-title {
            font-size: var(--text-lg);
            font-weight: 600;
            margin-bottom: var(--space-2);
        }
        
        .footer-links {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .footer-link {
            color: var(--muted);
            font-size: var(--text-sm);
            transition: color var(--transition-fast);
        }
        
        .footer-link:hover {
            color: var(--accent);
        }
        
        .footer-bottom {
            padding-top: var(--space-8);
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--muted);
            font-size: var(--text-sm);
        }
        
        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--overlay);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: var(--z-modal);
            padding: var(--space-4);
            opacity: 0;
            transition: opacity var(--transition-base);
        }
        
        .modal.active {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: var(--card);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            max-width: 500px;
            width: 100%;
            border: 2px solid var(--accent);
            box-shadow: var(--shadow-heavy);
            animation: slideInUp 0.3s ease;
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: var(--space-6);
        }
        
        .modal-title {
            font-size: var(--text-2xl);
            margin-bottom: var(--space-2);
        }
        
        .modal-subtitle {
            color: var(--muted);
            font-size: var(--text-sm);
        }
        
        .modal-body {
            margin-bottom: var(--space-6);
        }
        
        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .modal-action-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-4);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            color: var(--white);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .modal-action-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
            transform: translateX(5px);
        }
        
        .modal-action-btn.active {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--bg);
        }
        
        .modal-action-icon {
            font-size: var(--text-xl);
        }
        
        .modal-action-text {
            flex: 1;
            text-align: left;
            margin-left: var(--space-4);
            font-weight: 500;
        }
        
        .modal-action-arrow {
            color: var(--muted);
        }
        
        .modal-footer {
            display: flex;
            gap: var(--space-3);
        }
        
        /* Custom Lists Modal */
        .custom-lists-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .lists-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-6);
        }
        
        .lists-title {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: var(--text-2xl);
        }
        
        .lists-close {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--muted);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .lists-close:hover {
            background: var(--error);
            border-color: var(--error);
            color: var(--white);
        }
        
        .lists-container {
            flex: 1;
            overflow-y: auto;
            margin-bottom: var(--space-6);
            padding-right: var(--space-2);
        }
        
        .lists-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .lists-container::-webkit-scrollbar-track {
            background: var(--bg);
            border-radius: var(--radius-full);
        }
        
        .lists-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: var(--radius-full);
        }
        
        .lists-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-3) var(--space-4);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition-base);
        }
        
        .list-item:hover {
            background: var(--glass);
            border-color: var(--accent);
            transform: translateX(5px);
        }
        
        .list-item.active {
            background: rgba(245, 158, 11, 0.1);
            border-color: var(--accent);
        }
        
        .list-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;
        }
        
        .list-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg);
            font-size: var(--text-lg);
            font-weight: 600;
        }
        
        .list-name {
            font-weight: 500;
        }
        
        .list-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all var(--transition-fast);
        }
        
        .list-checkbox.checked {
            background: var(--accent);
            border-color: var(--accent);
        }
        
        .list-checkbox.checked::after {
            content: '✓';
            color: var(--bg);
            font-weight: bold;
            font-size: var(--text-sm);
        }
        
        .empty-lists {
            text-align: center;
            padding: var(--space-8);
            color: var(--muted);
        }
        
        .empty-lists-icon {
            font-size: var(--text-4xl);
            color: var(--accent);
            opacity: 0.5;
            margin-bottom: var(--space-4);
        }
        
        .lists-create {
            padding-top: var(--space-6);
            border-top: 1px solid var(--border);
        }
        
        .lists-create-input {
            display: flex;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .lists-create-input input {
            flex: 1;
            padding: var(--space-3) var(--space-4);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            color: var(--white);
        }
        
        .lists-create-input input:focus {
            border-color: var(--accent);
        }
        
        /* Auth Prompt Modal */
        .auth-prompt-modal .modal-content {
            text-align: center;
            max-width: 500px;
        }
        
        .auth-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-6);
            font-size: var(--text-3xl);
            color: var(--bg);
        }
        
        .auth-title {
            font-size: var(--text-3xl);
            margin-bottom: var(--space-3);
        }
        
        .auth-subtitle {
            color: var(--muted);
            font-size: var(--text-base);
            margin-bottom: var(--space-6);
        }
        
        .auth-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }
        
        .auth-button {
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            transition: all var(--transition-base);
        }
        
        .auth-button-primary {
            background: var(--gradient);
            color: var(--bg);
        }
        
        .auth-button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
        }
        
        .auth-button-secondary {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--white);
        }
        
        .auth-button-secondary:hover {
            background: var(--glass);
            border-color: var(--accent);
        }
        
        /* Notifications */
        .notification-container {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: var(--z-toast);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            max-width: 400px;
            width: calc(100% - var(--space-8));
        }
        
        .notification {
            padding: var(--space-4);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            animation: slideInRight 0.3s ease;
            box-shadow: var(--shadow);
        }
        
        .notification-success {
            background: rgba(16, 185, 129, 0.95);
            color: var(--white);
        }
        
        .notification-error {
            background: rgba(239, 68, 68, 0.95);
            color: var(--white);
        }
        
        .notification-info {
            background: rgba(59, 130, 246, 0.95);
            color: var(--white);
        }
        
        .notification-warning {
            background: rgba(245, 158, 11, 0.95);
            color: var(--bg);
        }
        
        .notification-icon {
            font-size: var(--text-xl);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity var(--transition-fast);
        }
        
        .notification-close:hover {
            opacity: 1;
        }
        
        /* Loading States */
        .skeleton {
            background: linear-gradient(90deg, var(--card) 25%, rgba(255,255,255,0.05) 50%, var(--card) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .skeleton-card {
            background: var(--card);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--border);
        }
        
        .skeleton-image {
            height: 200px;
            background: linear-gradient(90deg, var(--card) 25%, rgba(255,255,255,0.05) 50%, var(--card) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        
        .skeleton-content {
            padding: var(--space-4);
        }
        
        .skeleton-line {
            height: 12px;
            background: linear-gradient(90deg, var(--card) 25%, rgba(255,255,255,0.05) 50%, var(--card) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            margin-bottom: var(--space-3);
            border-radius: var(--radius-sm);
        }
        
        .skeleton-line.short {
            width: 60%;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 0 var(--space-3);
            }
            
            .nav-container {
                flex-wrap: wrap;
                padding: var(--space-2) 0;
            }
            
            .logo {
                order: 1;
            }
            
            .search-wrapper {
                order: 3;
                flex: 1 0 100%;
                margin-top: var(--space-2);
                max-width: none;
            }
            
            .nav-buttons {
                order: 2;
            }
            
            .hero-container {
                text-align: center;
            }
            
            .hero-stats {
                justify-content: center;
            }
            
            .hero-actions {
                justify-content: center;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .day-card-actions {
                flex-direction: column;
            }
            
            .app-buttons {
                flex-direction: column;
            }
            
            .app-button {
                width: 100%;
                justify-content: center;
            }
            
            .footer-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .restaurant-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Dark mode adjustments (already dark by default) */
        @media (prefers-color-scheme: dark) {
            :root {
                --border: rgba(255,255,255,0.15);
                --glass: rgba(255,255,255,0.05);
            }
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --accent: #ff9900;
                --muted: #aaaaaa;
            }
        }
        
        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
    </style>
</head>
<body>
    <!-- Modals -->
    <div id="actionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalRestaurantName">Restaurant Name</h3>
                <p class="modal-subtitle">Add this restaurant to your lists</p>
            </div>
            <div class="modal-body">
                <div class="modal-actions">
                    <button class="modal-action-btn" data-action="favorites" id="modalFavoritesBtn">
                        <i class="fas fa-heart modal-action-icon"></i>
                        <span class="modal-action-text" id="favoritesText">Add to Favorites</span>
                        <i class="fas fa-chevron-right modal-action-arrow"></i>
                    </button>
                    <button class="modal-action-btn" data-action="wantToGo" id="modalWantToGoBtn">
                        <i class="fas fa-map-marker-alt modal-action-icon"></i>
                        <span class="modal-action-text" id="wantToGoText">Want to Go</span>
                        <i class="fas fa-chevron-right modal-action-arrow"></i>
                    </button>
                    <button class="modal-action-btn" data-action="visited" id="modalVisitedBtn">
                        <i class="fas fa-utensils modal-action-icon"></i>
                        <span class="modal-action-text" id="visitedText">Mark as Visited</span>
                        <i class="fas fa-chevron-right modal-action-arrow"></i>
                    </button>
                    <button class="modal-action-btn" id="modalCustomListsBtn">
                        <i class="fas fa-list modal-action-icon"></i>
                        <span class="modal-action-text">Custom Lists</span>
                        <i class="fas fa-chevron-right modal-action-arrow"></i>
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary w-full" id="modalCancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <div id="customListsModal" class="modal custom-lists-modal">
        <div class="modal-content">
            <div class="lists-header">
                <h3 class="lists-title">
                    <i class="fas fa-list"></i>
                    Custom Lists
                </h3>
                <button class="lists-close" id="closeListsBtn">×</button>
            </div>
            
            <div class="lists-container" id="listsListContainer">
                <!-- Lists will be populated here -->
            </div>
            
            <div class="lists-create">
                <div class="lists-create-input">
                    <input type="text" id="newListName" placeholder="Enter new list name..." maxlength="50">
                    <button class="btn btn-primary" id="createListBtn">
                        <i class="fas fa-plus"></i> Create
                    </button>
                </div>
                <button class="btn btn-primary w-full" id="saveListsBtn">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="authPromptModal" class="modal auth-prompt-modal">
        <div class="modal-content">
            <div class="auth-icon">
                <i class="fas fa-lock"></i>
            </div>
            <div class="modal-header">
                <h3 class="auth-title">Sign In Required</h3>
                <p class="auth-subtitle">You need to be signed in to save restaurants. Create an account to save your favorites!</p>
            </div>
            <div class="modal-body">
                <div class="auth-buttons">
                    <button class="auth-button auth-button-primary" id="authPromptSignupBtn">
                        <i class="fas fa-user-plus"></i>
                        Create Free Account
                    </button>
                    <button class="auth-button auth-button-secondary" id="authPromptLoginBtn">
                        <i class="fas fa-sign-in-alt"></i>
                        Sign In to Existing Account
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost w-full" id="authPromptCloseBtn">Maybe Later</button>
            </div>
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Header -->
    <header class="header" id="mainHeader">
        <div class="container">
            <div class="nav-container">
                <img src="images/logo.png" alt="Zo2y" class="logo" onclick="location.href='index.html'">
                
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" id="search" class="search" placeholder="Search restaurants..." aria-label="Search restaurants">
                    <button class="clear-search" id="clearSearch" aria-label="Clear search">✕</button>
                    <div id="searchSuggestions" class="search-suggestions"></div>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn-ghost" onclick="location.href='restraunts.html'">
                        <i class="fas fa-compass"></i>
                        <span>Explore</span>
                    </button>
                    <button class="btn btn-secondary" id="userAccountBtn">
                        <i class="fas fa-user"></i>
                        <span>Account</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Guest Banner -->
    <div id="guestBanner" class="guest-banner container">
        <div class="banner-content">
            <span class="banner-text">Want to save your favorite restaurants? Sign in or create an account!</span>
            <div class="flex gap-3">
                <button class="btn btn-outline" id="bannerLoginBtn">Sign In</button>
                <button class="btn btn-primary" id="bannerSignupBtn">Create Account</button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-background"></div>
            <div class="hero-pattern"></div>
            
            <div class="container">
                <div class="hero-container">
                    <div class="hero-content">
                        <div class="hero-tag">
                            <i class="fas fa-star"></i>
                            Trusted by Food Lovers
                        </div>
                        
                        <h1 class="hero-title">
                            Discover Hidden Gems & Local Favorites
                        </h1>
                        
                        <p class="hero-subtitle">
                            Find authentic dining experiences based on real reviews from food lovers in your city.
                        </p>
                        
                        <div class="hero-actions">
                            <button class="btn btn-primary logged-out" id="startJourneyBtn">
                                <i class="fas fa-map-signs"></i>
                                Start Your Food Journey
                            </button>
                            
                            <button class="btn btn-outline logged-in" onclick="location.href='restraunts.html'">
                                <i class="fas fa-utensils"></i>
                                Explore All Restaurants
                            </button>
                        </div>
                        
                        <div class="hero-stats">
                            <div class="stat">
                                <span class="stat-number" id="restaurantCount">500+</span>
                                <span class="stat-label">Restaurants</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" id="reviewCount">10,000+</span>
                                <span class="stat-label">Reviews</span>
                            </div>
                            <div class="stat">
                                <span class="stat-number" id="userCount">5,000+</span>
                                <span class="stat-label">Food Lovers</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="spotlight-wrapper">
                        <div class="spotlight" id="spotlightCard">
                            <div class="spotlight-badge">
                                Featured
                            </div>
                            <div class="spotlight-image">
                                <img id="spotFoodImage" src="" alt="Featured restaurant">
                            </div>
                            <div class="spotlight-content">
                                <div class="spotlight-header">
                                    <h3 class="spotlight-title" id="spotName">Loading...</h3>
                                    <div class="spotlight-rating" id="spotRating">
                                        <i class="fas fa-star"></i>
                                        <span>...</span>
                                    </div>
                                </div>
                                <p class="spotlight-description" id="spotDesc">
                                    Loading restaurant details...
                                </p>
                                <div class="spotlight-actions">
                                    <button class="btn btn-secondary" id="spotlightViewBtn">
                                        View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Featured Restaurants -->
        <section class="section" id="featuredSection">
            <div class="container">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Featured Restaurants</h2>
                        <p class="section-subtitle">Handpicked selections based on quality and authenticity</p>
                    </div>
                    <a href="restraunts.html" class="btn btn-ghost">
                        View All
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                
                <div class="filter-bar" id="filterBar">
                    <!-- Filters will be populated here -->
                </div>
                
                <!-- Desktop Grid -->
                <div class="restaurant-grid" id="featuredGrid">
                    <!-- Skeleton loading -->
                    <div class="skeleton-card">
                        <div class="skeleton-image"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-line" style="width: 70%"></div>
                            <div class="skeleton-line short"></div>
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line" style="width: 40%"></div>
                        </div>
                    </div>
                    <!-- Repeat skeleton cards -->
                </div>
                
                <!-- Mobile Carousel -->
                <div class="carousel-container" id="featuredCarousel">
                    <div class="carousel-track" id="featuredCarouselTrack">
                        <!-- Skeleton loading for mobile -->
                    </div>
                    <div class="carousel-nav" id="featuredCarouselNav">
                        <!-- Dots will be populated -->
                    </div>
                </div>
                
                <div class="text-center mt-8">
                    <button class="btn btn-outline" onclick="location.href='restraunts.html'">
                        <i class="fas fa-arrow-right"></i>
                        View All Restaurants
                    </button>
                </div>
            </div>
        </section>

        <!-- Nearby Restaurants -->
        <section class="section bg-surface" id="nearbySection">
            <div class="container">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Nearby Restaurants</h2>
                        <p class="section-subtitle">Great food close to you</p>
                    </div>
                    <button class="btn btn-ghost" id="refreshLocationBtn">
                        <i class="fas fa-redo"></i>
                        Refresh Location
                    </button>
                </div>
                
                <div class="restaurant-grid" id="nearbyGrid">
                    <!-- Skeleton loading -->
                </div>
                
                <!-- Mobile Carousel -->
                <div class="carousel-container" id="nearbyCarousel">
                    <div class="carousel-track" id="nearbyCarouselTrack">
                        <!-- Skeleton loading for mobile -->
                    </div>
                    <div class="carousel-nav" id="nearbyCarouselNav">
                        <!-- Dots will be populated -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Restaurant of the Day -->
        <section class="section" id="daySection">
            <div class="container">
                <div class="restaurant-of-day">
                    <div class="day-background"></div>
                    <div class="day-content">
                        <div class="day-header">
                            <h2 class="day-title">Restaurant of the Day</h2>
                            <p class="day-subtitle">Our specially selected restaurant that stands out from the rest</p>
                        </div>
                        
                        <div class="day-card" id="dayCard">
                            <!-- Content will be populated -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- App Download -->
        <section class="section" id="appSection">
            <div class="container">
                <div class="app-download">
                    <div class="app-background"></div>
                    <div class="app-content">
                        <h2 class="app-title">Get the Zo2y App</h2>
                        <p class="app-subtitle">
                            Discover restaurants, save your favorites, and share reviews on the go. 
                            Available for iOS and Android.
                        </p>
                        
                        <div class="app-buttons">
                            <a href="#" class="app-button" id="iosAppButton">
                                <i class="fab fa-apple app-button-icon"></i>
                                <div class="app-button-text">
                                    <span>Download on the</span>
                                    <span>App Store</span>
                                </div>
                            </a>
                            
                            <a href="#" class="app-button" id="androidAppButton">
                                <i class="fab fa-google-play app-button-icon"></i>
                                <div class="app-button-text">
                                    <span>Get it on</span>
                                    <span>Google Play</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-column">
                    <h4 class="footer-title">Explore</h4>
                    <div class="footer-links">
                        <a href="restraunts.html" class="footer-link">All Restaurants</a>
                        <a href="categories.html" class="footer-link">By Category</a>
                        <a href="#" class="footer-link">Trending</a>
                        <a href="#" class="footer-link">New Arrivals</a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Community</h4>
                    <div class="footer-links">
                        <a href="blog.html" class="footer-link">Food Blog</a>
                        <a href="guides.html" class="footer-link">Neighborhood Guides</a>
                        <a href="#" class="footer-link">Events</a>
                        <a href="#" class="footer-link">Food Tours</a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Business</h4>
                    <div class="footer-links">
                        <a href="add-restaurant.html" class="footer-link">Add Your Restaurant</a>
                        <a href="partners.html" class="footer-link">Partnerships</a>
                        <a href="contact.html" class="footer-link">Contact Us</a>
                        <a href="#" class="footer-link">Advertising</a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h4 class="footer-title">Support</h4>
                    <div class="footer-links">
                        <a href="about.html" class="footer-link">About Zo2y</a>
                        <a href="help.html" class="footer-link">Help Center</a>
                        <a href="terms.html" class="footer-link">Terms & Privacy</a>
                        <a href="#" class="footer-link">FAQ</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>© 2025 Zo2y — Built with ❤️ for food lovers</p>
                <p class="text-muted mt-2">Join thousands discovering authentic dining experiences</p>
            </div>
        </div>
    </footer>

    <!-- Main Application Script -->
    <script>
    // ==================== CONFIGURATION ====================
    const CONFIG = {
        SUPABASE_URL: 'https://gfkhjbztayjyojsgdpgk.supabase.co',
        SUPABASE_KEY: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdma2hqYnp0YXlqeW9qc2dkcGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTYyNjQsImV4cCI6MjA3NTY3MjI2NH0.WUb2yDAwCeokdpWCPeH13FE8NhWF6G8e6ivTsgu6b2s',
        
        // Performance optimizations
        OPTIMIZATIONS: {
            lazyLoadImages: true,
            debounceDelay: 300,
            mobileImageQuality: 'medium',
            desktopImageQuality: 'high',
            mobileLoadLimit: 8,
            desktopLoadLimit: 16,
            cacheTTL: 5 * 60 * 1000, // 5 minutes
            retryAttempts: 3
        },
        
        // Feature flags
        FEATURES: {
            enableGeolocation: true,
            enableSpotlight: true,
            enableNotifications: true,
            enableOffline: false,
            enableAnalytics: true
        },
        
        // API endpoints
        ENDPOINTS: {
            restaurants: '/restraunts',
            lists: '/lists',
            listRestaurants: '/lists_restraunts',
            users: '/users',
            reviews: '/reviews'
        },
        
        // Default values
        DEFAULTS: {
            userLocation: { lat: 40.7128, lng: -74.0060 }, // NYC
            radius: 10, // miles
            sortBy: 'rating',
            categories: ['All', 'Burgers', 'Pizza', 'Asian', 'Mexican', 'Italian', 'Cafe', 'Seafood']
        }
    };

    // ==================== STATE MANAGEMENT ====================
    const STATE = {
        // User state
        isLoggedIn: false,
        currentUser: null,
        userProfile: null,
        userLocation: null,
        userLists: [],
        
        // App state
        restaurants: [],
        filteredRestaurants: [],
        featuredRestaurants: [],
        nearbyRestaurants: [],
        spotlightRestaurants: [],
        restaurantOfTheDay: null,
        customLists: [],
        selectedLists: new Set(),
        
        // UI state
        currentModalRestaurant: null,
        spotlightIndex: 0,
        currentFilter: 'all',
        searchQuery: '',
        isLoading: true,
        isMobile: false,
        
        // Cache
        cache: new Map(),
        imageCache: new Map(),
        
        // Instances
        supabase: null,
        spotlightInterval: null,
        geolocationWatchId: null,
        imageObserver: null
    };

    // ==================== DOM ELEMENTS ====================
    const ELEMENTS = {
        // Header
        header: document.getElementById('mainHeader'),
        search: document.getElementById('search'),
        clearSearch: document.getElementById('clearSearch'),
        searchSuggestions: document.getElementById('searchSuggestions'),
        userAccountBtn: document.getElementById('userAccountBtn'),
        
        // Banner
        guestBanner: document.getElementById('guestBanner'),
        bannerLoginBtn: document.getElementById('bannerLoginBtn'),
        bannerSignupBtn: document.getElementById('bannerSignupBtn'),
        
        // Hero
        startJourneyBtn: document.getElementById('startJourneyBtn'),
        restaurantCount: document.getElementById('restaurantCount'),
        reviewCount: document.getElementById('reviewCount'),
        userCount: document.getElementById('userCount'),
        
        // Spotlight
        spotlightCard: document.getElementById('spotlightCard'),
        spotFoodImage: document.getElementById('spotFoodImage'),
        spotName: document.getElementById('spotName'),
        spotDesc: document.getElementById('spotDesc'),
        spotRating: document.getElementById('spotRating'),
        spotlightViewBtn: document.getElementById('spotlightViewBtn'),
        
        // Featured section
        filterBar: document.getElementById('filterBar'),
        featuredGrid: document.getElementById('featuredGrid'),
        featuredCarousel: document.getElementById('featuredCarousel'),
        featuredCarouselTrack: document.getElementById('featuredCarouselTrack'),
        featuredCarouselNav: document.getElementById('featuredCarouselNav'),
        
        // Nearby section
        refreshLocationBtn: document.getElementById('refreshLocationBtn'),
        nearbyGrid: document.getElementById('nearbyGrid'),
        nearbyCarousel: document.getElementById('nearbyCarousel'),
        nearbyCarouselTrack: document.getElementById('nearbyCarouselTrack'),
        nearbyCarouselNav: document.getElementById('nearbyCarouselNav'),
        
        // Restaurant of the day
        dayCard: document.getElementById('dayCard'),
        
        // Modals
        actionsModal: document.getElementById('actionsModal'),
        modalRestaurantName: document.getElementById('modalRestaurantName'),
        modalFavoritesBtn: document.getElementById('modalFavoritesBtn'),
        modalWantToGoBtn: document.getElementById('modalWantToGoBtn'),
        modalVisitedBtn: document.getElementById('modalVisitedBtn'),
        modalCustomListsBtn: document.getElementById('modalCustomListsBtn'),
        modalCancelBtn: document.getElementById('modalCancelBtn'),
        
        // Custom lists modal
        customListsModal: document.getElementById('customListsModal'),
        listsListContainer: document.getElementById('listsListContainer'),
        newListName: document.getElementById('newListName'),
        createListBtn: document.getElementById('createListBtn'),
        saveListsBtn: document.getElementById('saveListsBtn'),
        closeListsBtn: document.getElementById('closeListsBtn'),
        
        // Auth modal
        authPromptModal: document.getElementById('authPromptModal'),
        authPromptSignupBtn: document.getElementById('authPromptSignupBtn'),
        authPromptLoginBtn: document.getElementById('authPromptLoginBtn'),
        authPromptCloseBtn: document.getElementById('authPromptCloseBtn'),
        
        // Notifications
        notificationContainer: document.getElementById('notificationContainer'),
        
        // App buttons
        iosAppButton: document.getElementById('iosAppButton'),
        androidAppButton: document.getElementById('androidAppButton')
    };

    // ==================== UTILITY FUNCTIONS ====================
    const UTILS = {
        // Device detection
        isMobile: () => {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        },
        
        // Throttle function
        throttle: (func, limit) => {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        },
        
        // Debounce function
        debounce: (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        },
        
        // Format distance
        formatDistance: (meters) => {
            if (meters < 1000) {
                return `${Math.round(meters)}m`;
            }
            return `${(meters / 1000).toFixed(1)}km`;
        },
        
        // Format rating
        formatRating: (rating) => {
            if (!rating) return 'No ratings';
            return rating.toFixed(1);
        },
        
        // Get category icon
        getCategoryIcon: (category) => {
            const icons = {
                'Burgers': '🍔',
                'Pizza': '🍕',
                'Asian': '🍜',
                'Mexican': '🌮',
                'Italian': '🍝',
                'Cafe': '☕',
                'Seafood': '🐟',
                'Indian': '🍛',
                'Thai': '🍲',
                'Sushi': '🍣',
                'Vegetarian': '🥗',
                'Dessert': '🍰',
                'Breakfast': '🍳',
                'Barbecue': '🍖'
            };
            return icons[category] || '🍴';
        },
        
        // Calculate distance between coordinates (Haversine formula)
        calculateDistance: (lat1, lon1, lat2, lon2) => {
            const R = 6371e3; // Earth's radius in meters
            const φ1 = lat1 * Math.PI / 180;
            const φ2 = lat2 * Math.PI / 180;
            const Δφ = (lat2 - lat1) * Math.PI / 180;
            const Δλ = (lon2 - lon1) * Math.PI / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c; // Distance in meters
        },
        
        // Generate unique ID
        generateId: () => {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        },
        
        // Sanitize HTML
        sanitize: (str) => {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        },
        
        // Parse URL parameters
        getUrlParams: () => {
            const params = {};
            window.location.search.substring(1).split('&').forEach(param => {
                const [key, value] = param.split('=');
                if (key) {
                    params[decodeURIComponent(key)] = decodeURIComponent(value || '');
                }
            });
            return params;
        },
        
        // Copy to clipboard
        copyToClipboard: async (text) => {
            try {
                await navigator.clipboard.writeText(text);
                return true;
            } catch (err) {
                console.error('Failed to copy:', err);
                return false;
            }
        },
        
        // Share functionality
        shareContent: async (title, text, url) => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title,
                        text,
                        url
                    });
                    return true;
                } catch (err) {
                    console.error('Share failed:', err);
                }
            }
            return false;
        },
        
        // Local storage wrapper
        storage: {
            get: (key) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : null;
                } catch (error) {
                    console.error('Error reading from localStorage:', error);
                    return null;
                }
            },
            
            set: (key, value) => {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    return true;
                } catch (error) {
                    console.error('Error writing to localStorage:', error);
                    return false;
                }
            },
            
            remove: (key) => {
                try {
                    localStorage.removeItem(key);
                    return true;
                } catch (error) {
                    console.error('Error removing from localStorage:', error);
                    return false;
                }
            },
            
            clear: () => {
                try {
                    localStorage.clear();
                    return true;
                } catch (error) {
                    console.error('Error clearing localStorage:', error);
                    return false;
                }
            }
        }
    };

    // ==================== IMAGE MANAGEMENT ====================
    const IMAGE_MANAGER = {
        init: () => {
            if ('IntersectionObserver' in window) {
                STATE.imageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const img = entry.target;
                            if (img.dataset.src) {
                                IMAGE_MANAGER.loadImage(img);
                            }
                        }
                    });
                }, {
                    rootMargin: '50px',
                    threshold: 0.1
                });
            }
        },
        
        loadImage: (img) => {
            if (!img.dataset.src) return;
            
            const src = img.dataset.src;
            
            // Check cache first
            if (STATE.imageCache.has(src)) {
                img.src = STATE.imageCache.get(src);
                img.classList.add('loaded');
                return;
            }
            
            // Load with quality optimization
            let optimizedSrc = src;
            if (STATE.isMobile && src.includes('supabase.co')) {
                optimizedSrc += '?width=400&quality=80';
            } else if (!STATE.isMobile && src.includes('supabase.co')) {
                optimizedSrc += '?width=800&quality=90';
            }
            
            const image = new Image();
            image.onload = () => {
                img.src = optimizedSrc;
                img.classList.add('loaded');
                STATE.imageCache.set(src, optimizedSrc);
                
                // Unobserve if using IntersectionObserver
                if (STATE.imageObserver) {
                    STATE.imageObserver.unobserve(img);
                }
            };
            
            image.onerror = () => {
                console.warn('Failed to load image:', src);
                img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iNDAwIiBoZWlnaHQ9IjMwMCIgZmlsbD0iIzBiMTYzMyIvPjx0ZXh0IHg9IjIwMCIgeT0iMTUwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiM4Y2EzYzciIHRleHQtYW5jaG9yPSJtaWRkbGUiIGR5PSIuM2VtIj5JbWFnZSBub3QgYXZhaWxhYmxlPC90ZXh0Pjwvc3ZnPg==';
            };
            
            image.src = optimizedSrc;
        },
        
        preload: (urls) => {
            urls.forEach(url => {
                if (!STATE.imageCache.has(url)) {
                    const img = new Image();
                    img.src = url;
                    STATE.imageCache.set(url, url);
                }
            });
        }
    };

    // ==================== NOTIFICATION SYSTEM ====================
    const NOTIFICATION = {
        show: (message, type = 'info', duration = 3000) => {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icon = NOTIFICATION.getIcon(type);
            notification.innerHTML = `
                <i class="fas fa-${icon} notification-icon"></i>
                <div class="notification-content">${UTILS.sanitize(message)}</div>
                <button class="notification-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            ELEMENTS.notificationContainer.appendChild(notification);
            
            // Auto-remove after duration
            const removeNotification = () => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            };
            
            // Close button
            notification.querySelector('.notification-close').addEventListener('click', removeNotification);
            
            // Auto-remove
            if (duration > 0) {
                setTimeout(removeNotification, duration);
            }
            
            // Trigger confetti for success
            if (type === 'success' && window.confetti) {
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
            
            return notification;
        },
        
        getIcon: (type) => {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle'
            };
            return icons[type] || 'info-circle';
        },
        
        clear: () => {
            ELEMENTS.notificationContainer.innerHTML = '';
        }
    };

    // ==================== API SERVICE ====================
    const API = {
        init: () => {
            try {
                STATE.supabase = window.supabase.createClient(
                    CONFIG.SUPABASE_URL,
                    CONFIG.SUPABASE_KEY,
                    {
                        auth: {
                            autoRefreshToken: true,
                            persistSession: true,
                            detectSessionInUrl: true
                        }
                    }
                );
                console.log('Supabase initialized successfully');
                return true;
            } catch (error) {
                console.error('Failed to initialize Supabase:', error);
                NOTIFICATION.show('Failed to connect to server', 'error');
                return false;
            }
        },
        
        // Authentication
        auth: {
            getSession: async () => {
                try {
                    const { data, error } = await STATE.supabase.auth.getSession();
                    if (error) throw error;
                    return data.session;
                } catch (error) {
                    console.error('Error getting session:', error);
                    return null;
                }
            },
            
            signIn: async (email, password) => {
                try {
                    const { data, error } = await STATE.supabase.auth.signInWithPassword({
                        email,
                        password
                    });
                    if (error) throw error;
                    return data;
                } catch (error) {
                    throw error;
                }
            },
            
            signUp: async (email, password, metadata = {}) => {
                try {
                    const { data, error } = await STATE.supabase.auth.signUp({
                        email,
                        password,
                        options: {
                            data: metadata
                        }
                    });
                    if (error) throw error;
                    return data;
                } catch (error) {
                    throw error;
                }
            },
            
            signOut: async () => {
                try {
                    const { error } = await STATE.supabase.auth.signOut();
                    if (error) throw error;
                    return true;
                } catch (error) {
                    throw error;
                }
            },
            
            resetPassword: async (email) => {
                try {
                    const { error } = await STATE.supabase.auth.resetPasswordForEmail(email);
                    if (error) throw error;
                    return true;
                } catch (error) {
                    throw error;
                }
            }
        },
        
        // Restaurants
        restaurants: {
            getAll: async (options = {}) => {
                const cacheKey = `restaurants_${JSON.stringify(options)}`;
                const cached = STATE.cache.get(cacheKey);
                
                if (cached && Date.now() - cached.timestamp < CONFIG.OPTIMIZATIONS.cacheTTL) {
                    return cached.data;
                }
                
                try {
                    let query = STATE.supabase
                        .from('restraunts')
                        .select('*');
                    
                    // Apply filters
                    if (options.category && options.category !== 'all') {
                        query = query.eq('category', options.category);
                    }
                    
                    if (options.search) {
                        query = query.ilike('name', `%${options.search}%`);
                    }
                    
                    // Apply sorting
                    if (options.sortBy) {
                        query = query.order(options.sortBy, { ascending: options.sortOrder === 'asc' });
                    } else {
                        query = query.order('rating', { ascending: false });
                    }
                    
                    // Apply pagination
                    if (options.limit) {
                        query = query.limit(options.limit);
                    }
                    
                    if (options.offset) {
                        query = query.range(options.offset, options.offset + (options.limit || 10) - 1);
                    }
                    
                    const { data, error } = await query;
                    if (error) throw error;
                    
                    // Cache the result
                    STATE.cache.set(cacheKey, {
                        data,
                        timestamp: Date.now()
                    });
                    
                    return data;
                } catch (error) {
                    console.error('Error fetching restaurants:', error);
                    throw error;
                }
            },
            
            getById: async (id) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('restraunts')
                        .select('*')
                        .eq('id', id)
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error fetching restaurant:', error);
                    throw error;
                }
            },
            
            getBySlug: async (slug) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('restraunts')
                        .select('*')
                        .eq('slug', slug)
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error fetching restaurant:', error);
                    throw error;
                }
            },
            
            search: async (query, limit = 10) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('restraunts')
                        .select('*')
                        .or(`name.ilike.%${query}%,description.ilike.%${query}%,category.ilike.%${query}%`)
                        .limit(limit);
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error searching restaurants:', error);
                    throw error;
                }
            }
        },
        
        // Lists
        lists: {
            getUserLists: async (userId) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('lists')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false });
                    
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Error fetching user lists:', error);
                    throw error;
                }
            },
            
            createList: async (userId, title) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('lists')
                        .insert([{
                            user_id: userId,
                            title: title.trim(),
                            created_at: new Date().toISOString()
                        }])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error creating list:', error);
                    throw error;
                }
            },
            
            deleteList: async (listId) => {
                try {
                    // First delete all restaurant associations
                    await STATE.supabase
                        .from('lists_restraunts')
                        .delete()
                        .eq('list_id', listId);
                    
                    // Then delete the list
                    const { error } = await STATE.supabase
                        .from('lists')
                        .delete()
                        .eq('id', listId);
                    
                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('Error deleting list:', error);
                    throw error;
                }
            },
            
            addRestaurantToList: async (listId, restaurantId) => {
                try {
                    const { error } = await STATE.supabase
                        .from('lists_restraunts')
                        .insert([{
                            list_id: listId,
                            restraunt_id: restaurantId,
                            added_at: new Date().toISOString()
                        }]);
                    
                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('Error adding restaurant to list:', error);
                    throw error;
                }
            },
            
            removeRestaurantFromList: async (listId, restaurantId) => {
                try {
                    const { error } = await STATE.supabase
                        .from('lists_restraunts')
                        .delete()
                        .match({
                            list_id: listId,
                            restraunt_id: restaurantId
                        });
                    
                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('Error removing restaurant from list:', error);
                    throw error;
                }
            },
            
            getListRestaurants: async (listId) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('lists_restraunts')
                        .select(`
                            restraunt_id,
                            added_at,
                            restraunts (*)
                        `)
                        .eq('list_id', listId);
                    
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Error fetching list restaurants:', error);
                    throw error;
                }
            },
            
            isRestaurantInList: async (listId, restaurantId) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('lists_restraunts')
                        .select('*')
                        .match({
                            list_id: listId,
                            restraunt_id: restaurantId
                        })
                        .single();
                    
                    if (error && error.code !== 'PGRST116') throw error;
                    return !!data;
                } catch (error) {
                    console.error('Error checking restaurant in list:', error);
                    throw error;
                }
            }
        },
        
        // User profile
        users: {
            getProfile: async (userId) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('users')
                        .select('*')
                        .eq('id', userId)
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error fetching user profile:', error);
                    throw error;
                }
            },
            
            updateProfile: async (userId, updates) => {
                try {
                    const { data, error } = await STATE.supabase
                        .from('users')
                        .update(updates)
                        .eq('id', userId)
                        .select()
                        .single();
                    
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Error updating user profile:', error);
                    throw error;
                }
            }
        }
    };

    // ==================== LIST MANAGER ====================
    const LIST_MANAGER = {
        userLists: [],
        defaultLists: {
            favorites: null,
            wantToGo: null,
            visited: null
        },
        
        init: async () => {
            if (!STATE.isLoggedIn) return;
            
            try {
                // Fetch user lists
                STATE.userLists = await API.lists.getUserLists(STATE.currentUser.id);
                STATE.customLists = STATE.userLists.filter(list => 
                    !['Favorites', 'Want to Go', 'Visited'].includes(list.title)
                );
                
                // Setup default lists
                LIST_MANAGER.defaultLists.favorites = STATE.userLists.find(l => l.title === 'Favorites');
                LIST_MANAGER.defaultLists.wantToGo = STATE.userLists.find(l => l.title === 'Want to Go');
                LIST_MANAGER.defaultLists.visited = STATE.userLists.find(l => l.title === 'Visited');
                
                // Create default lists if they don't exist
                await LIST_MANAGER.ensureDefaultLists();
                
                console.log('List manager initialized');
            } catch (error) {
                console.error('Error initializing list manager:', error);
            }
        },
        
        ensureDefaultLists: async () => {
            if (!STATE.isLoggedIn) return;
            
            const defaultListTitles = ['Favorites', 'Want to Go', 'Visited'];
            
            for (const title of defaultListTitles) {
                let list = STATE.userLists.find(l => l.title === title);
                
                if (!list) {
                    try {
                        list = await API.lists.createList(STATE.currentUser.id, title);
                        STATE.userLists.push(list);
                        
                        if (title === 'Favorites') LIST_MANAGER.defaultLists.favorites = list;
                        if (title === 'Want to Go') LIST_MANAGER.defaultLists.wantToGo = list;
                        if (title === 'Visited') LIST_MANAGER.defaultLists.visited = list;
                    } catch (error) {
                        console.error(`Error creating ${title} list:`, error);
                    }
                }
            }
        },
        
        toggleRestaurantInList: async (listType, restaurantId) => {
            if (!STATE.isLoggedIn) {
                UI.showAuthPrompt();
                return false;
            }
            
            const list = LIST_MANAGER.defaultLists[listType];
            if (!list) {
                console.error(`${listType} list not found`);
                return false;
            }
            
            try {
                const isInList = await API.lists.isRestaurantInList(list.id, restaurantId);
                
                if (isInList) {
                    await API.lists.removeRestaurantFromList(list.id, restaurantId);
                    NOTIFICATION.show(`Removed from ${list.title}`, 'info');
                    return 'removed';
                } else {
                    await API.lists.addRestaurantToList(list.id, restaurantId);
                    NOTIFICATION.show(`Added to ${list.title}`, 'success');
                    return 'added';
                }
            } catch (error) {
                console.error(`Error toggling restaurant in ${listType}:`, error);
                NOTIFICATION.show('Failed to update list', 'error');
                return false;
            }
        },
        
        getRestaurantListStatus: async (restaurantId) => {
            if (!STATE.isLoggedIn) {
                return {
                    favorites: false,
                    wantToGo: false,
                    visited: false
                };
            }
            
            const status = {
                favorites: false,
                wantToGo: false,
                visited: false
            };
            
            try {
                for (const [listType, list] of Object.entries(LIST_MANAGER.defaultLists)) {
                    if (list) {
                        status[listType] = await API.lists.isRestaurantInList(list.id, restaurantId);
                    }
                }
            } catch (error) {
                console.error('Error getting restaurant list status:', error);
            }
            
            return status;
        },
        
        // Custom lists management
        toggleRestaurantInCustomList: async (listId, restaurantId) => {
            if (!STATE.isLoggedIn) {
                UI.showAuthPrompt();
                return false;
            }
            
            try {
                const isInList = await API.lists.isRestaurantInList(listId, restaurantId);
                
                if (isInList) {
                    await API.lists.removeRestaurantFromList(listId, restaurantId);
                    return 'removed';
                } else {
                    await API.lists.addRestaurantToList(listId, restaurantId);
                    return 'added';
                }
            } catch (error) {
                console.error('Error toggling restaurant in custom list:', error);
                throw error;
            }
        },
        
        createCustomList: async (name) => {
            if (!STATE.isLoggedIn) {
                UI.showAuthPrompt();
                return null;
            }
            
            try {
                const list = await API.lists.createList(STATE.currentUser.id, name);
                STATE.customLists.unshift(list);
                return list;
            } catch (error) {
                console.error('Error creating custom list:', error);
                throw error;
            }
        },
        
        deleteCustomList: async (listId) => {
            try {
                await API.lists.deleteList(listId);
                STATE.customLists = STATE.customLists.filter(list => list.id !== listId);
                return true;
            } catch (error) {
                console.error('Error deleting custom list:', error);
                throw error;
            }
        }
    };

    // ==================== UI COMPONENTS ====================
    const UI = {
        // Initialize UI
        init: () => {
            STATE.isMobile = UTILS.isMobile();
            
            // Set initial mobile/desktop classes
            if (STATE.isMobile) {
                document.body.classList.add('mobile');
                document.body.classList.remove('desktop');
            } else {
                document.body.classList.add('desktop');
                document.body.classList.remove('mobile');
            }
            
            // Initialize components
            IMAGE_MANAGER.init();
            UI.bindEvents();
            UI.setupIntersectionObserver();
            UI.setupHeaderScroll();
            
            console.log('UI initialized');
        },
        
        // Bind event listeners
        bindEvents: () => {
            // Navigation
            ELEMENTS.userAccountBtn.addEventListener('click', UI.handleAccountClick);
            
            // Search
            ELEMENTS.search.addEventListener('input', UTILS.debounce(UI.handleSearch, 300));
            ELEMENTS.clearSearch.addEventListener('click', UI.clearSearch);
            ELEMENTS.search.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    UI.performSearch();
                }
            });
            
            // Banner buttons
            ELEMENTS.bannerLoginBtn.addEventListener('click', () => window.location.href = 'login.html');
            ELEMENTS.bannerSignupBtn.addEventListener('click', () => window.location.href = 'sign-up.html');
            
            // Hero buttons
            ELEMENTS.startJourneyBtn.addEventListener('click', UI.handleStartJourney);
            ELEMENTS.spotlightViewBtn.addEventListener('click', () => {
                if (STATE.spotlightRestaurants[STATE.spotlightIndex]) {
                    window.location.href = `restaurant.html?slug=${STATE.spotlightRestaurants[STATE.spotlightIndex].slug}`;
                }
            });
            ELEMENTS.spotlightCard.addEventListener('click', () => {
                if (STATE.spotlightRestaurants[STATE.spotlightIndex]) {
                    window.location.href = `restaurant.html?slug=${STATE.spotlightRestaurants[STATE.spotlightIndex].slug}`;
                }
            });
            
            // Location refresh
            ELEMENTS.refreshLocationBtn.addEventListener('click', LOCATION.requestLocation);
            
            // Modal buttons
            ELEMENTS.modalFavoritesBtn.addEventListener('click', () => UI.handleListAction('favorites'));
            ELEMENTS.modalWantToGoBtn.addEventListener('click', () => UI.handleListAction('wantToGo'));
            ELEMENTS.modalVisitedBtn.addEventListener('click', () => UI.handleListAction('visited'));
            ELEMENTS.modalCustomListsBtn.addEventListener('click', UI.showCustomListsModal);
            ELEMENTS.modalCancelBtn.addEventListener('click', UI.hideModal);
            
            // Custom lists modal
            ELEMENTS.createListBtn.addEventListener('click', UI.createCustomList);
            ELEMENTS.saveListsBtn.addEventListener('click', UI.saveCustomLists);
            ELEMENTS.closeListsBtn.addEventListener('click', UI.hideCustomListsModal);
            
            // Auth modal
            ELEMENTS.authPromptSignupBtn.addEventListener('click', () => window.location.href = 'sign-up.html');
            ELEMENTS.authPromptLoginBtn.addEventListener('click', () => window.location.href = 'login.html');
            ELEMENTS.authPromptCloseBtn.addEventListener('click', UI.hideAuthPrompt);
            
            // Close modals on background click
            ELEMENTS.actionsModal.addEventListener('click', (e) => {
                if (e.target === ELEMENTS.actionsModal) {
                    UI.hideModal();
                }
            });
            
            ELEMENTS.customListsModal.addEventListener('click', (e) => {
                if (e.target === ELEMENTS.customListsModal) {
                    UI.hideCustomListsModal();
                }
            });
            
            ELEMENTS.authPromptModal.addEventListener('click', (e) => {
                if (e.target === ELEMENTS.authPromptModal) {
                    UI.hideAuthPrompt();
                }
            });
            
            // App download buttons
            ELEMENTS.iosAppButton.addEventListener('click', (e) => {
                e.preventDefault();
                NOTIFICATION.show('Coming soon to the App Store!', 'info');
            });
            
            ELEMENTS.androidAppButton.addEventListener('click', (e) => {
                e.preventDefault();
                NOTIFICATION.show('Coming soon to Google Play!', 'info');
            });
            
            // Window events
            window.addEventListener('resize', UTILS.debounce(UI.handleResize, 250));
            window.addEventListener('scroll', UTILS.throttle(UI.handleScroll, 100));
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Escape key closes modals
                if (e.key === 'Escape') {
                    UI.hideModal();
                    UI.hideCustomListsModal();
                    UI.hideAuthPrompt();
                }
                
                // Ctrl/Cmd + K focuses search
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    ELEMENTS.search.focus();
                }
            });
        },
        
        // Setup IntersectionObserver for lazy loading
        setupIntersectionObserver: () => {
            if (!STATE.imageObserver) return;
            
            // Observe all images with data-src
            document.querySelectorAll('img[data-src]').forEach(img => {
                STATE.imageObserver.observe(img);
            });
        },
        
        // Header scroll effect
        setupHeaderScroll: () => {
            const header = ELEMENTS.header;
            let lastScroll = 0;
            
            const handleHeaderScroll = () => {
                const currentScroll = window.pageYOffset;
                
                if (currentScroll > 100) {
                    header.classList.add('scrolled');
                    
                    if (currentScroll > lastScroll && currentScroll > 200) {
                        header.style.transform = 'translateY(-100%)';
                    } else {
                        header.style.transform = 'translateY(0)';
                    }
                } else {
                    header.classList.remove('scrolled');
                    header.style.transform = 'translateY(0)';
                }
                
                lastScroll = currentScroll;
            };
            
            window.addEventListener('scroll', UTILS.throttle(handleHeaderScroll, 100));
        },
        
        // Event handlers
        handleAccountClick: () => {
            if (STATE.isLoggedIn) {
                window.location.href = 'profile.html';
            } else {
                window.location.href = 'login.html';
            }
        },
        
        handleSearch: (e) => {
            const query = e.target.value.trim();
            STATE.searchQuery = query;
            
            // Show/hide clear button
            ELEMENTS.clearSearch.style.display = query ? 'block' : 'none';
            
            // Show suggestions
            if (query.length > 2) {
                UI.showSearchSuggestions(query);
            } else {
                UI.hideSearchSuggestions();
            }
        },
        
        clearSearch: () => {
            ELEMENTS.search.value = '';
            STATE.searchQuery = '';
            ELEMENTS.clearSearch.style.display = 'none';
            UI.hideSearchSuggestions();
        },
        
        performSearch: () => {
            const query = ELEMENTS.search.value.trim();
            if (query) {
                window.location.href = `restraunts.html?search=${encodeURIComponent(query)}`;
            }
        },
        
        showSearchSuggestions: async (query) => {
            try {
                const results = await API.restaurants.search(query, 5);
                
                if (results.length > 0) {
                    ELEMENTS.searchSuggestions.innerHTML = results.map(restaurant => `
                        <div class="suggestion-item" data-slug="${restaurant.slug}">
                            <div class="suggestion-info">
                                <div class="suggestion-name">${UTILS.sanitize(restaurant.name)}</div>
                                <div class="suggestion-category">${UTILS.sanitize(restaurant.category)}</div>
                            </div>
                        </div>
                    `).join('');
                    
                    // Add click handlers
                    ELEMENTS.searchSuggestions.querySelectorAll('.suggestion-item').forEach(item => {
                        item.addEventListener('click', () => {
                            const slug = item.dataset.slug;
                            window.location.href = `restaurant.html?slug=${slug}`;
                        });
                    });
                    
                    ELEMENTS.searchSuggestions.classList.add('show');
                } else {
                    ELEMENTS.searchSuggestions.innerHTML = `
                        <div class="suggestion-item">
                            <div class="suggestion-info">
                                <div class="suggestion-name">No results found</div>
                            </div>
                        </div>
                    `;
                    ELEMENTS.searchSuggestions.classList.add('show');
                }
            } catch (error) {
                console.error('Error fetching search suggestions:', error);
                UI.hideSearchSuggestions();
            }
        },
        
        hideSearchSuggestions: () => {
            ELEMENTS.searchSuggestions.classList.remove('show');
        },
        
        handleStartJourney: () => {
            if (STATE.isLoggedIn) {
                window.location.href = 'restraunts.html';
            } else {
                window.location.href = 'sign-up.html';
            }
        },
        
        handleResize: () => {
            const wasMobile = STATE.isMobile;
            STATE.isMobile = UTILS.isMobile();
            
            // Update layout if mobile state changed
            if (wasMobile !== STATE.isMobile) {
                if (STATE.isMobile) {
                    document.body.classList.add('mobile');
                    document.body.classList.remove('desktop');
                } else {
                    document.body.classList.add('desktop');
                    document.body.classList.remove('mobile');
                }
                
                // Re-render restaurant sections
                if (STATE.restaurants.length > 0) {
                    UI.renderRestaurantSections();
                }
            }
        },
        
        handleScroll: () => {
            // Add any scroll-based effects here
        },
        
        // Modal handlers
        showModal: (restaurant) => {
            if (!STATE.isLoggedIn) {
                UI.showAuthPrompt();
                return;
            }
            
            STATE.currentModalRestaurant = restaurant;
            ELEMENTS.modalRestaurantName.textContent = restaurant.name;
            
            // Update button states
            UI.updateModalButtons(restaurant.id);
            
            // Show modal
            ELEMENTS.actionsModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        },
        
        hideModal: () => {
            ELEMENTS.actionsModal.classList.remove('active');
            document.body.style.overflow = '';
            STATE.currentModalRestaurant = null;
        },
        
        updateModalButtons: async (restaurantId) => {
            const status = await LIST_MANAGER.getRestaurantListStatus(restaurantId);
            
            // Update favorites button
            ELEMENTS.modalFavoritesBtn.classList.toggle('active', status.favorites);
            ELEMENTS.modalFavoritesBtn.querySelector('.modal-action-text').textContent = 
                status.favorites ? 'Remove from Favorites' : 'Add to Favorites';
            
            // Update want to go button
            ELEMENTS.modalWantToGoBtn.classList.toggle('active', status.wantToGo);
            ELEMENTS.modalWantToGoBtn.querySelector('.modal-action-text').textContent = 
                status.wantToGo ? 'Remove from Want to Go' : 'Want to Go';
            
            // Update visited button
            ELEMENTS.modalVisitedBtn.classList.toggle('active', status.visited);
            ELEMENTS.modalVisitedBtn.querySelector('.modal-action-text').textContent = 
                status.visited ? 'Remove from Visited' : 'Mark as Visited';
        },
        
        handleListAction: async (listType) => {
            if (!STATE.currentModalRestaurant) return;
            
            const result = await LIST_MANAGER.toggleRestaurantInList(listType, STATE.currentModalRestaurant.id);
            
            if (result) {
                // Update modal buttons
                UI.updateModalButtons(STATE.currentModalRestaurant.id);
                
                // Update restaurant cards
                UI.updateRestaurantCards(STATE.currentModalRestaurant.id);
                
                // Close modal after successful action
                setTimeout(() => {
                    UI.hideModal();
                }, 500);
            }
        },
        
        showCustomListsModal: async () => {
            if (!STATE.currentModalRestaurant) return;
            
            // Hide main modal
            UI.hideModal();
            
            // Load custom lists if not already loaded
            if (STATE.customLists.length === 0 && STATE.isLoggedIn) {
                try {
                    STATE.customLists = await API.lists.getUserLists(STATE.currentUser.id);
                    STATE.customLists = STATE.customLists.filter(list => 
                        !['Favorites', 'Want to Go', 'Visited'].includes(list.title)
                    );
                } catch (error) {
                    console.error('Error loading custom lists:', error);
                    NOTIFICATION.show('Failed to load lists', 'error');
                    return;
                }
            }
            
            // Load current restaurant's list status
            STATE.selectedLists.clear();
            if (STATE.isLoggedIn && STATE.currentModalRestaurant) {
                try {
                    for (const list of STATE.customLists) {
                        const isInList = await API.lists.isRestaurantInList(list.id, STATE.currentModalRestaurant.id);
                        if (isInList) {
                            STATE.selectedLists.add(list.id);
                        }
                    }
                } catch (error) {
                    console.error('Error checking list status:', error);
                }
            }
            
            // Render custom lists
            UI.renderCustomLists();
            
            // Show modal
            ELEMENTS.customListsModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        },
        
        hideCustomListsModal: () => {
            ELEMENTS.customListsModal.classList.remove('active');
            document.body.style.overflow = '';
            STATE.selectedLists.clear();
        },
        
        renderCustomLists: () => {
            if (!STATE.customLists || STATE.customLists.length === 0) {
                ELEMENTS.listsListContainer.innerHTML = `
                    <div class="empty-lists">
                        <i class="fas fa-list empty-lists-icon"></i>
                        <h4>No custom lists</h4>
                        <p>Create your first list to get started</p>
                    </div>
                `;
                return;
            }
            
            ELEMENTS.listsListContainer.innerHTML = `
                <div class="lists-list">
                    ${STATE.customLists.map(list => `
                        <div class="list-item ${STATE.selectedLists.has(list.id) ? 'active' : ''}" data-id="${list.id}">
                            <div class="list-info">
                                <div class="list-icon">${list.title.charAt(0)}</div>
                                <span class="list-name">${UTILS.sanitize(list.title)}</span>
                            </div>
                            <div class="list-checkbox ${STATE.selectedLists.has(list.id) ? 'checked' : ''}"></div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            // Add click handlers
            ELEMENTS.listsListContainer.querySelectorAll('.list-item').forEach(item => {
                item.addEventListener('click', () => {
                    const listId = item.dataset.id;
                    
                    if (STATE.selectedLists.has(listId)) {
                        STATE.selectedLists.delete(listId);
                        item.classList.remove('active');
                        item.querySelector('.list-checkbox').classList.remove('checked');
                    } else {
                        STATE.selectedLists.add(listId);
                        item.classList.add('active');
                        item.querySelector('.list-checkbox').classList.add('checked');
                    }
                });
            });
        },
        
        createCustomList: async () => {
            const name = ELEMENTS.newListName.value.trim();
            
            if (!name) {
                NOTIFICATION.show('Please enter a list name', 'warning');
                return;
            }
            
            if (name.length > 50) {
                NOTIFICATION.show('List name must be less than 50 characters', 'warning');
                return;
            }
            
            try {
                ELEMENTS.createListBtn.disabled = true;
                ELEMENTS.createListBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                
                const newList = await LIST_MANAGER.createCustomList(name);
                
                // Add to selected lists
                STATE.selectedLists.add(newList.id);
                
                // Clear input
                ELEMENTS.newListName.value = '';
                
                // Re-render lists
                UI.renderCustomLists();
                
                NOTIFICATION.show(`List "${name}" created`, 'success');
            } catch (error) {
                NOTIFICATION.show('Failed to create list', 'error');
                console.error('Error creating list:', error);
            } finally {
                ELEMENTS.createListBtn.disabled = false;
                ELEMENTS.createListBtn.innerHTML = '<i class="fas fa-plus"></i> Create';
            }
        },
        
        saveCustomLists: async () => {
            if (!STATE.currentModalRestaurant) {
                UI.hideCustomListsModal();
                return;
            }
            
            try {
                ELEMENTS.saveListsBtn.disabled = true;
                ELEMENTS.saveListsBtn.textContent = 'Saving...';
                
                const restaurantId = STATE.currentModalRestaurant.id;
                const promises = [];
                
                // Process each custom list
                for (const list of STATE.customLists) {
                    const shouldBeInList = STATE.selectedLists.has(list.id);
                    const isInList = await API.lists.isRestaurantInList(list.id, restaurantId);
                    
                    if (shouldBeInList && !isInList) {
                        promises.push(API.lists.addRestaurantToList(list.id, restaurantId));
                    } else if (!shouldBeInList && isInList) {
                        promises.push(API.lists.removeRestaurantFromList(list.id, restaurantId));
                    }
                }
                
                // Wait for all operations to complete
                await Promise.all(promises);
                
                NOTIFICATION.show('Lists updated successfully', 'success');
                UI.hideCustomListsModal();
                
                // Update restaurant cards
                UI.updateRestaurantCards(restaurantId);
            } catch (error) {
                console.error('Error saving lists:', error);
                NOTIFICATION.show('Failed to update lists', 'error');
            } finally {
                ELEMENTS.saveListsBtn.disabled = false;
                ELEMENTS.saveListsBtn.textContent = 'Save Changes';
            }
        },
        
        showAuthPrompt: () => {
            ELEMENTS.authPromptModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        },
        
        hideAuthPrompt: () => {
            ELEMENTS.authPromptModal.classList.remove('active');
            document.body.style.overflow = '';
        },
        
        // Restaurant card rendering
        createRestaurantCard: (restaurant, badges = {}) => {
            const card = document.createElement('div');
            card.className = 'restaurant-card';
            card.dataset.id = restaurant.id;
            card.dataset.slug = restaurant.slug;
            
            // Build badges HTML
            let badgesHTML = '';
            if (badges.favorites) badgesHTML += '<div class="card-badge"><i class="fas fa-heart"></i></div>';
            if (badges.wantToGo) badgesHTML += '<div class="card-badge"><i class="fas fa-map-marker-alt"></i></div>';
            if (badges.visited) badgesHTML += '<div class="card-badge"><i class="fas fa-utensils"></i></div>';
            
            // Top rated badge
            let topRatedBadge = '';
            if (restaurant.rating >= 4.5) {
                topRatedBadge = '<div class="card-badge"><i class="fas fa-crown"></i> Top Rated</div>';
            }
            
            card.innerHTML = `
                <div class="card-image">
                    <div class="card-overlay"></div>
                    <img data-src="${restaurant.image || ''}" alt="${UTILS.sanitize(restaurant.name)}">
                    
                    <div class="card-badges">
                        ${topRatedBadge}
                        ${badgesHTML}
                    </div>
                    
                    <div class="card-actions">
                        <button class="card-action-btn" title="Save to lists">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                </div>
                
                <div class="card-content">
                    <div class="card-header">
                        <h3 class="card-title">${UTILS.sanitize(restaurant.name)}</h3>
                        <div class="card-rating">
                            <i class="fas fa-star"></i>
                            ${UTILS.formatRating(restaurant.rating)}
                        </div>
                    </div>
                    
                    <div class="card-meta">
                        <span class="card-category">
                            <i class="fas fa-tag"></i>
                            ${UTILS.sanitize(restaurant.category)}
                        </span>
                        <span class="card-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${restaurant.distance ? UTILS.formatDistance(restaurant.distance) : 'City Center'}
                        </span>
                    </div>
                    
                    <p class="card-description">
                        ${UTILS.sanitize(restaurant.description || 'No description available')}
                    </p>
                    
                    <div class="card-footer">
                        <span class="card-price">
                            ${restaurant.price_range || '$$'}
                        </span>
                        <span class="card-distance">
                            ${restaurant.distance ? `${UTILS.formatDistance(restaurant.distance)} away` : ''}
                        </span>
                    </div>
                </div>
            `;
            
            // Add click handlers
            const cardLink = card.querySelector('.card-image, .card-content');
            cardLink.addEventListener('click', (e) => {
                if (!e.target.closest('.card-actions')) {
                    window.location.href = `restaurant.html?slug=${restaurant.slug}`;
                }
            });
            
            const saveButton = card.querySelector('.card-action-btn');
            saveButton.addEventListener('click', (e) => {
                e.stopPropagation();
                UI.showModal(restaurant);
            });
            
            // Lazy load image
            const img = card.querySelector('img[data-src]');
            if (img && STATE.imageObserver) {
                STATE.imageObserver.observe(img);
            }
            
            return card;
        },
        
        // Render restaurant sections
        renderRestaurantSections: () => {
            // Clear existing content
            ELEMENTS.featuredGrid.innerHTML = '';
            ELEMENTS.nearbyGrid.innerHTML = '';
            ELEMENTS.featuredCarouselTrack.innerHTML = '';
            ELEMENTS.nearbyCarouselTrack.innerHTML = '';
            
            // Render featured restaurants
            const featuredToShow = STATE.featuredRestaurants.slice(0, STATE.isMobile ? 4 : 8);
            
            featuredToShow.forEach(async (restaurant) => {
                // Get list status for badges
                const status = await LIST_MANAGER.getRestaurantListStatus(restaurant.id);
                
                // Create card
                const card = UI.createRestaurantCard(restaurant, status);
                
                // Add to desktop grid
                ELEMENTS.featuredGrid.appendChild(card.cloneNode(true));
                
                // Add to mobile carousel
                const carouselCard = card.cloneNode(true);
                carouselCard.classList.add('carousel-card');
                ELEMENTS.featuredCarouselTrack.appendChild(carouselCard);
            });
            
            // Render nearby restaurants
            const nearbyToShow = STATE.nearbyRestaurants.slice(0, STATE.isMobile ? 4 : 8);
            
            nearbyToShow.forEach(async (restaurant) => {
                // Get list status for badges
                const status = await LIST_MANAGER.getRestaurantListStatus(restaurant.id);
                
                // Create card
                const card = UI.createRestaurantCard(restaurant, status);
                
                // Add to desktop grid
                ELEMENTS.nearbyGrid.appendChild(card.cloneNode(true));
                
                // Add to mobile carousel
                const carouselCard = card.cloneNode(true);
                carouselCard.classList.add('carousel-card');
                ELEMENTS.nearbyCarouselTrack.appendChild(carouselCard);
            });
            
            // Setup carousel navigation
            UI.setupCarouselNavigation('featured');
            UI.setupCarouselNavigation('nearby');
            
            // Show/hide appropriate sections based on device
            if (STATE.isMobile) {
                ELEMENTS.featuredGrid.classList.add('hidden');
                ELEMENTS.featuredCarousel.classList.remove('hidden');
                ELEMENTS.nearbyGrid.classList.add('hidden');
                ELEMENTS.nearbyCarousel.classList.remove('hidden');
            } else {
                ELEMENTS.featuredGrid.classList.remove('hidden');
                ELEMENTS.featuredCarousel.classList.add('hidden');
                ELEMENTS.nearbyGrid.classList.remove('hidden');
                ELEMENTS.nearbyCarousel.classList.add('hidden');
            }
        },
        
        setupCarouselNavigation: (section) => {
            const track = document.getElementById(`${section}CarouselTrack`);
            const nav = document.getElementById(`${section}CarouselNav`);
            
            if (!track || !nav) return;
            
            const cards = track.querySelectorAll('.carousel-card');
            if (cards.length === 0) return;
            
            // Create dots
            nav.innerHTML = '';
            cards.forEach((_, index) => {
                const dot = document.createElement('div');
                dot.className = `carousel-dot ${index === 0 ? 'active' : ''}`;
                dot.dataset.index = index;
                nav.appendChild(dot);
                
                dot.addEventListener('click', () => {
                    UI.scrollCarouselTo(section, index);
                });
            });
            
            // Update active dot on scroll
            track.addEventListener('scroll', UTILS.throttle(() => {
                const scrollLeft = track.scrollLeft;
                const cardWidth = cards[0].offsetWidth + parseInt(getComputedStyle(track).gap);
                const activeIndex = Math.round(scrollLeft / cardWidth);
                
                nav.querySelectorAll('.carousel-dot').forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeIndex);
                });
            }, 100));
        },
        
        scrollCarouselTo: (section, index) => {
            const track = document.getElementById(`${section}CarouselTrack`);
            const cards = track.querySelectorAll('.carousel-card');
            
            if (!cards[index]) return;
            
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(getComputedStyle(track).gap);
            track.scrollTo({
                left: index * (cardWidth + gap),
                behavior: 'smooth'
            });
        },
        
        updateRestaurantCards: async (restaurantId) => {
            // Find and update all instances of this restaurant
            const cards = document.querySelectorAll(`.restaurant-card[data-id="${restaurantId}"]`);
            
            if (cards.length === 0) return;
            
            // Get updated status
            const status = await LIST_MANAGER.getRestaurantListStatus(restaurantId);
            
            // Update each card
            cards.forEach(card => {
                const badgesContainer = card.querySelector('.card-badges');
                if (!badgesContainer) return;
                
                // Clear existing badges (except top rated)
                const existingBadges = badgesContainer.querySelectorAll('.card-badge:not(.card-badge i.fa-crown)');
                existingBadges.forEach(badge => badge.remove());
                
                // Add updated badges
                let badgesHTML = '';
                if (status.favorites) badgesHTML += '<div class="card-badge"><i class="fas fa-heart"></i></div>';
                if (status.wantToGo) badgesHTML += '<div class="card-badge"><i class="fas fa-map-marker-alt"></i></div>';
                if (status.visited) badgesHTML += '<div class="card-badge"><i class="fas fa-utensils"></i></div>';
                
                // Insert badges after top rated badge if it exists
                const topRatedBadge = badgesContainer.querySelector('.card-badge i.fa-crown');
                if (topRatedBadge) {
                    topRatedBadge.closest('.card-badge').insertAdjacentHTML('afterend', badgesHTML);
                } else {
                    badgesContainer.innerHTML += badgesHTML;
                }
            });
        },
        
        // Filter bar
        renderFilterBar: () => {
            ELEMENTS.filterBar.innerHTML = CONFIG.DEFAULTS.categories.map(category => `
                <button class="filter-btn ${category === 'All' ? 'active' : ''}" 
                        data-filter="${category.toLowerCase()}">
                    ${category}
                </button>
            `).join('');
            
            // Add click handlers
            ELEMENTS.filterBar.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const filter = btn.dataset.filter;
                    
                    // Update active state
                    ELEMENTS.filterBar.querySelectorAll('.filter-btn').forEach(b => {
                        b.classList.remove('active');
                    });
                    btn.classList.add('active');
                    
                    // Apply filter
                    UI.applyFilter(filter);
                });
            });
        },
        
        applyFilter: (filter) => {
            STATE.currentFilter = filter;
            
            if (filter === 'all') {
                STATE.filteredRestaurants = [...STATE.featuredRestaurants];
            } else {
                STATE.filteredRestaurants = STATE.featuredRestaurants.filter(
                    restaurant => restaurant.category.toLowerCase() === filter
                );
            }
            
            // Re-render featured section with filtered results
            UI.renderRestaurantSections();
        },
        
        // Spotlight
        updateSpotlight: () => {
            if (!STATE.spotlightRestaurants.length) return;
            
            const restaurant = STATE.spotlightRestaurants[STATE.spotlightIndex];
            
            // Update DOM elements
            ELEMENTS.spotName.textContent = restaurant.name;
            ELEMENTS.spotDesc.textContent = restaurant.description || 'No description available';
            ELEMENTS.spotRating.innerHTML = `<i class="fas fa-star"></i> ${UTILS.formatRating(restaurant.rating)}`;
            
            // Update image
            if (restaurant.image) {
                ELEMENTS.spotFoodImage.dataset.src = restaurant.image;
                IMAGE_MANAGER.loadImage(ELEMENTS.spotFoodImage);
            }
            
            // Update event handlers
            ELEMENTS.spotlightViewBtn.onclick = () => {
                window.location.href = `restaurant.html?slug=${restaurant.slug}`;
            };
            
            ELEMENTS.spotlightCard.onclick = () => {
                window.location.href = `restaurant.html?slug=${restaurant.slug}`;
            };
        },
        
        startSpotlightRotation: () => {
            if (STATE.spotlightInterval) {
                clearInterval(STATE.spotlightInterval);
            }
            
            if (STATE.spotlightRestaurants.length > 1) {
                STATE.spotlightInterval = setInterval(() => {
                    STATE.spotlightIndex = (STATE.spotlightIndex + 1) % STATE.spotlightRestaurants.length;
                    UI.updateSpotlight();
                }, 5000); // Rotate every 5 seconds
            }
        },
        
        // Restaurant of the day
        renderRestaurantOfTheDay: () => {
            if (!STATE.restaurantOfTheDay) return;
            
            const restaurant = STATE.restaurantOfTheDay;
            
            ELEMENTS.dayCard.innerHTML = `
                <div class="day-card-image">
                    <img data-src="${restaurant.image || ''}" alt="${UTILS.sanitize(restaurant.name)}">
                    <div class="day-card-badge">Restaurant of the Day</div>
                </div>
                
                <div class="day-card-content">
                    <div class="day-card-header">
                        <h3 class="day-card-title">${UTILS.sanitize(restaurant.name)}</h3>
                        <div class="day-card-rating">
                            <i class="fas fa-star"></i>
                            ${UTILS.formatRating(restaurant.rating)}
                        </div>
                    </div>
                    
                    <div class="day-card-meta">
                        <span class="card-category">
                            <i class="fas fa-tag"></i>
                            ${UTILS.sanitize(restaurant.category)}
                        </span>
                        <span class="card-location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${restaurant.distance ? `${UTILS.formatDistance(restaurant.distance)} away` : 'City Center'}
                        </span>
                    </div>
                    
                    <p class="day-card-description">
                        ${UTILS.sanitize(restaurant.description || 'No description available')}
                    </p>
                    
                    <div class="day-card-actions">
                        <button class="btn btn-primary" id="dayCardViewBtn">
                            <i class="fas fa-eye"></i>
                            View Details
                        </button>
                        <button class="btn btn-outline" id="dayCardSaveBtn">
                            <i class="fas fa-bookmark"></i>
                            Save
                        </button>
                    </div>
                </div>
            `;
            
            // Add event handlers
            const viewBtn = document.getElementById('dayCardViewBtn');
            const saveBtn = document.getElementById('dayCardSaveBtn');
            
            if (viewBtn) {
                viewBtn.addEventListener('click', () => {
                    window.location.href = `restaurant.html?slug=${restaurant.slug}`;
                });
            }
            
            if (saveBtn) {
                saveBtn.addEventListener('click', () => {
                    UI.showModal(restaurant);
                });
            }
            
            // Lazy load image
            const img = ELEMENTS.dayCard.querySelector('img[data-src]');
            if (img && STATE.imageObserver) {
                STATE.imageObserver.observe(img);
            }
        },
        
        // Update auth UI
        updateAuthUI: () => {
            if (STATE.isLoggedIn) {
                // Hide guest banner
                ELEMENTS.guestBanner.classList.remove('show');
                
                // Update account button
                const userName = STATE.userProfile?.username || STATE.currentUser?.email?.split('@')[0] || 'Account';
                ELEMENTS.userAccountBtn.innerHTML = `
                    <i class="fas fa-user"></i>
                    <span>${userName}</span>
                `;
                
                // Update hero buttons
                document.querySelectorAll('.logged-out').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.logged-in').forEach(el => el.style.display = 'flex');
            } else {
                // Show guest banner
                ELEMENTS.guestBanner.classList.add('show');
                
                // Update account button
                ELEMENTS.userAccountBtn.innerHTML = `
                    <i class="fas fa-sign-in-alt"></i>
                    <span>Sign In</span>
                `;
                
                // Update hero buttons
                document.querySelectorAll('.logged-out').forEach(el => el.style.display = 'flex');
                document.querySelectorAll('.logged-in').forEach(el => el.style.display = 'none');
            }
        },
        
        // Loading states
        showLoading: () => {
            document.body.classList.add('loading');
        },
        
        hideLoading: () => {
            document.body.classList.remove('loading');
        }
    };

    // ==================== LOCATION SERVICE ====================
    const LOCATION = {
        currentLocation: null,
        watchId: null,
        
        init: () => {
            if (!CONFIG.FEATURES.enableGeolocation) {
                STATE.userLocation = CONFIG.DEFAULTS.userLocation;
                return Promise.resolve(CONFIG.DEFAULTS.userLocation);
            }
            
            return LOCATION.getLocation()
                .then(location => {
                    STATE.userLocation = location;
                    return location;
                })
                .catch(error => {
                    console.warn('Failed to get location:', error);
                    STATE.userLocation = CONFIG.DEFAULTS.userLocation;
                    return CONFIG.DEFAULTS.userLocation;
                });
        },
        
        getLocation: () => {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation not supported'));
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            timestamp: position.timestamp
                        };
                        
                        // Store in localStorage for future use
                        UTILS.storage.set('userLocation', location);
                        resolve(location);
                    },
                    (error) => {
                        console.warn('Geolocation error:', error);
                        
                        // Try to get from localStorage
                        const savedLocation = UTILS.storage.get('userLocation');
                        if (savedLocation) {
                            resolve(savedLocation);
                        } else {
                            reject(error);
                        }
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 600000 // 10 minutes
                    }
                );
            });
        },
        
        requestLocation: () => {
            NOTIFICATION.show('Getting your location...', 'info');
            
            LOCATION.getLocation()
                .then(location => {
                    STATE.userLocation = location;
                    NOTIFICATION.show('Location updated successfully', 'success');
                    
                    // Recalculate nearby restaurants
                    if (STATE.restaurants.length > 0) {
                        APP.calculateNearbyRestaurants();
                        UI.renderRestaurantSections();
                    }
                })
                .catch(error => {
                    console.error('Failed to get location:', error);
                    NOTIFICATION.show('Failed to get location. Using default location.', 'warning');
                });
        },
        
        startWatching: () => {
            if (!CONFIG.FEATURES.enableGeolocation || !navigator.geolocation) {
                return;
            }
            
            LOCATION.watchId = navigator.geolocation.watchPosition(
                (position) => {
                    const newLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: position.timestamp
                    };
                    
                    // Only update if location changed significantly
                    if (!LOCATION.currentLocation || 
                        UTILS.calculateDistance(
                            newLocation.lat, newLocation.lng,
                            LOCATION.currentLocation.lat, LOCATION.currentLocation.lng
                        ) > 100) { // 100 meters
                        
                        LOCATION.currentLocation = newLocation;
                        STATE.userLocation = newLocation;
                        UTILS.storage.set('userLocation', newLocation);
                        
                        // Update nearby restaurants
                        if (STATE.restaurants.length > 0) {
                            APP.calculateNearbyRestaurants();
                            UI.renderRestaurantSections();
                        }
                    }
                },
                (error) => {
                    console.warn('Geolocation watch error:', error);
                },
                {
                    enableHighAccuracy: false,
                    maximumAge: 30000, // 30 seconds
                    timeout: 5000
                }
            );
        },
        
        stopWatching: () => {
            if (LOCATION.watchId && navigator.geolocation) {
                navigator.geolocation.clearWatch(LOCATION.watchId);
                LOCATION.watchId = null;
            }
        },
        
        calculateDistances: (restaurants, userLocation) => {
            return restaurants.map(restaurant => {
                if (restaurant.latitude && restaurant.longitude && userLocation) {
                    const distance = UTILS.calculateDistance(
                        userLocation.lat, userLocation.lng,
                        restaurant.latitude, restaurant.longitude
                    );
                    return { ...restaurant, distance };
                }
                return restaurant;
            });
        }
    };

    // ==================== MAIN APPLICATION ====================
    const APP = {
        init: async () => {
            console.log('Initializing Zo2y application...');
            
            // Show loading state
            UI.showLoading();
            
            // Initialize services
            const apiInitialized = API.init();
            if (!apiInitialized) {
                NOTIFICATION.show('Failed to initialize application', 'error');
                UI.hideLoading();
                return;
            }
            
            // Check authentication
            await APP.checkAuth();
            
            // Initialize location
            await LOCATION.init();
            
            // Initialize list manager
            await LIST_MANAGER.init();
            
            // Initialize UI
            UI.init();
            
            // Load restaurant data
            await APP.loadRestaurants();
            
            // Start location watching
            LOCATION.startWatching();
            
            // Hide loading state
            UI.hideLoading();
            
            // Update stats (mock data for now)
            APP.updateStats();
            
            console.log('Zo2y application initialized successfully');
        },
        
        checkAuth: async () => {
            try {
                const session = await API.auth.getSession();
                
                if (session) {
                    STATE.isLoggedIn = true;
                    STATE.currentUser = session.user;
                    
                    // Load user profile
                    try {
                        STATE.userProfile = await API.users.getProfile(session.user.id);
                    } catch (error) {
                        console.warn('Failed to load user profile:', error);
                    }
                }
                
                // Update UI
                UI.updateAuthUI();
                
                // Listen for auth changes
                STATE.supabase.auth.onAuthStateChange((event, session) => {
                    console.log('Auth state changed:', event);
                    
                    if (session) {
                        STATE.isLoggedIn = true;
                        STATE.currentUser = session.user;
                        
                        // Load user profile
                        API.users.getProfile(session.user.id)
                            .then(profile => {
                                STATE.userProfile = profile;
                                UI.updateAuthUI();
                                LIST_MANAGER.init();
                            })
                            .catch(error => {
                                console.warn('Failed to load user profile:', error);
                            });
                    } else {
                        STATE.isLoggedIn = false;
                        STATE.currentUser = null;
                        STATE.userProfile = null;
                        STATE.userLists = [];
                        STATE.customLists = [];
                        UI.updateAuthUI();
                    }
                });
            } catch (error) {
                console.error('Error checking auth:', error);
            }
        },
        
        loadRestaurants: async () => {
            try {
                // Show loading state
                ELEMENTS.featuredGrid.innerHTML = `
                    <div class="skeleton-card">
                        <div class="skeleton-image"></div>
                        <div class="skeleton-content">
                            <div class="skeleton-line" style="width: 70%"></div>
                            <div class="skeleton-line short"></div>
                            <div class="skeleton-line"></div>
                            <div class="skeleton-line" style="width: 40%"></div>
                        </div>
                    </div>
                `.repeat(STATE.isMobile ? 4 : 8);
                
                // Fetch restaurants
                const restaurants = await API.restaurants.getAll({
                    limit: STATE.isMobile ? CONFIG.OPTIMIZATIONS.mobileLoadLimit : CONFIG.OPTIMIZATIONS.desktopLoadLimit,
                    sortBy: 'rating',
                    sortOrder: 'desc'
                });
                
                STATE.restaurants = restaurants;
                
                // Process restaurants
                APP.processRestaurants(restaurants);
                
                // Update UI
                UI.renderFilterBar();
                UI.renderRestaurantSections();
                UI.renderRestaurantOfTheDay();
                
                // Setup spotlight
                if (CONFIG.FEATURES.enableSpotlight && STATE.spotlightRestaurants.length > 0) {
                    UI.updateSpotlight();
                    UI.startSpotlightRotation();
                }
                
                // Preload images for better UX
                const imageUrls = restaurants
                    .slice(0, 10)
                    .map(r => r.image)
                    .filter(Boolean);
                IMAGE_MANAGER.preload(imageUrls);
                
            } catch (error) {
                console.error('Error loading restaurants:', error);
                NOTIFICATION.show('Failed to load restaurants', 'error');
                
                // Show error state
                ELEMENTS.featuredGrid.innerHTML = `
                    <div class="text-center p-8">
                        <i class="fas fa-exclamation-triangle text-4xl text-error mb-4"></i>
                        <h3 class="text-xl font-bold mb-2">Failed to Load Restaurants</h3>
                        <p class="text-muted mb-4">Please try again later</p>
                        <button class="btn btn-primary" onclick="APP.loadRestaurants()">
                            <i class="fas fa-redo"></i>
                            Retry
                        </button>
                    </div>
                `;
            }
        },
        
        processRestaurants: (restaurants) => {
            // Calculate distances for all restaurants
            const restaurantsWithDistance = LOCATION.calculateDistances(restaurants, STATE.userLocation);
            
            // Sort by rating for featured
            STATE.featuredRestaurants = [...restaurantsWithDistance]
                .sort((a, b) => b.rating - a.rating)
                .slice(0, 12);
            
            // Sort by distance for nearby
            STATE.nearbyRestaurants = [...restaurantsWithDistance]
                .filter(r => r.distance)
                .sort((a, b) => a.distance - b.distance)
                .slice(0, 12);
            
            // Select restaurant of the day (highest rated)
            STATE.restaurantOfTheDay = STATE.featuredRestaurants[0];
            
            // Select spotlight restaurants (top 6)
            STATE.spotlightRestaurants = STATE.featuredRestaurants.slice(0, 6);
            
            // Set filtered restaurants (initially all featured)
            STATE.filteredRestaurants = [...STATE.featuredRestaurants];
        },
        
        calculateNearbyRestaurants: () => {
            if (!STATE.userLocation) return;
            
            // Recalculate distances
            const restaurantsWithDistance = LOCATION.calculateDistances(STATE.restaurants, STATE.userLocation);
            
            // Update nearby restaurants
            STATE.nearbyRestaurants = [...restaurantsWithDistance]
                .filter(r => r.distance)
                .sort((a, b) => a.distance - b.distance)
                .slice(0, 12);
            
            // Update restaurant of the day distance
            if (STATE.restaurantOfTheDay) {
                const updatedRestaurant = restaurantsWithDistance.find(
                    r => r.id === STATE.restaurantOfTheDay.id
                );
                if (updatedRestaurant) {
                    STATE.restaurantOfTheDay = updatedRestaurant;
                }
            }
        },
        
        updateStats: () => {
            // Mock data for now - in production, these would come from your API
            ELEMENTS.restaurantCount.textContent = '500+';
            ELEMENTS.reviewCount.textContent = '10,000+';
            ELEMENTS.userCount.textContent = '5,000+';
        },
        
        // Cleanup on page unload
        cleanup: () => {
            LOCATION.stopWatching();
            
            if (STATE.spotlightInterval) {
                clearInterval(STATE.spotlightInterval);
            }
            
            if (STATE.imageObserver) {
                STATE.imageObserver.disconnect();
            }
        }
    };

    // ==================== INITIALIZATION ====================
    document.addEventListener('DOMContentLoaded', () => {
        APP.init();
    });

    window.addEventListener('beforeunload', () => {
        APP.cleanup();
    });

    // Make APP available globally for debugging
    window.APP = APP;
    </script>
</body>
</html>