<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=yes" />
  <meta name="robots" content="index,follow,max-image-preview:none,noimageindex" />
  <title>Zo2y | All Your Interests in One Place</title>
  <meta name="description" content="All your interests in one place. Track favorites, build custom lists, and follow friends across movies, TV, games, books, music, and restaurants." />
  <link rel="canonical" href="https://www.zo2y.com/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Zo2y" />
  <meta property="og:title" content="Zo2y | All Your Interests in One Place" />
  <meta property="og:description" content="Track favorites, build custom lists, and follow friends across movies, TV, games, books, music, and restaurants." />
  <meta property="og:url" content="https://www.zo2y.com/" />
  <meta property="og:image" content="https://www.zo2y.com/images/zo2y-search-illustration.png" />
  <meta property="og:image:alt" content="Zo2y illustration with gaming, movies, and TV." />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Zo2y | All Your Interests in One Place" />
  <meta name="twitter:description" content="Track favorites, build custom lists, and follow friends across movies, TV, games, books, music, and restaurants." />
  <meta name="twitter:image" content="https://www.zo2y.com/images/zo2y-search-illustration.png" />
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Zo2y",
      "url": "https://www.zo2y.com/",
      "description": "All your interests in one place.",
      "image": "https://www.zo2y.com/images/zo2y-search-illustration.png"
    }
  </script>
  <link rel="preconnect" href="https://gfkhjbztayjyojsgdpgk.supabase.co" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0b1633;
      --bg-2: #0f1d40;
      --card: #132347;
      --card-2: #172b58;
      --muted: #8ca3c7;
      --accent: #f59e0b;
      --white: #ffffff;
      --border: rgba(255,255,255,0.12);
      --gradient: linear-gradient(135deg, #f59e0b 0%, #ffb84d 100%);
      --surface: rgba(12, 26, 57, 0.84);
      --shadow: 0 12px 34px rgba(0,0,0,0.28);
      --ok: #10b981;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    html, body {
      min-height: 100%;
      background:
        radial-gradient(circle at 18% -8%, rgba(245, 158, 11, 0.16), transparent 35%),
        radial-gradient(circle at 85% -12%, rgba(88, 130, 255, 0.22), transparent 42%),
        var(--bg);
      color: var(--white);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
    }

    body {
      padding-bottom: 18px;
    }

    a { color: inherit; text-decoration: none; }

    .container {
      width: min(1240px, calc(100% - 28px));
      margin: 0 auto;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px) saturate(180%);
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }

    .header-inner {
      min-height: 72px;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 0;
      flex-wrap: wrap;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.2px;
    }

    .brand img {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      object-fit: cover;
    }

    .search-wrap {
      flex: 1;
      min-width: 210px;
      max-width: 420px;
      position: relative;
      margin-left: 8px;
    }

    .search-wrap i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 13px;
    }

    .search {
      width: 100%;
      height: 42px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--white);
      padding: 0 14px 0 34px;
      outline: none;
    }

    .search:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.14);
    }

    .header-actions {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .top-nav {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      opacity: 0.92;
    }

    .nav-pill {
      border: 1px solid transparent;
      color: #e2ecff;
      background: transparent;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      padding: 8px 10px;
      transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
    }

    .nav-pill:hover {
      border-color: var(--border);
      color: var(--accent);
      background: rgba(255,255,255,0.04);
    }

    .auth-actions {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      border: 1px solid var(--border);
      background: var(--card);
      color: var(--white);
      height: 40px;
      padding: 0 14px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: border-color 0.2s ease, transform 0.2s ease;
    }

    .btn:hover {
      border-color: var(--accent);
      transform: translateY(-1px);
    }

    .btn-primary {
      background: var(--gradient);
      color: #0b1633;
      border: 0;
    }

    .page-shell {
      margin-top: 18px;
      display: grid;
      gap: 18px;
    }

    .spotlight {
      position: relative;
      border: 1px solid var(--border);
      border-radius: 24px;
      overflow: hidden;
      min-height: 360px;
      box-shadow: var(--shadow);
      background: linear-gradient(145deg, #132347, #0f1f43);
      isolation: isolate;
    }

    .spotlight-bg {
      position: absolute;
      inset: 0;
      background: linear-gradient(120deg, #12203e 0%, #1b2f61 48%, #243b77 100%);
      background-size: cover;
      background-position: center;
      transition: background-image 0.22s ease;
      z-index: -2;
    }

    .spotlight::before {
      content: "";
      position: absolute;
      inset: 0;
      z-index: -1;
      background:
        linear-gradient(100deg, rgba(6, 13, 28, 0.9) 0%, rgba(8, 16, 35, 0.7) 42%, rgba(13, 25, 52, 0.25) 100%),
        radial-gradient(circle at 80% 22%, rgba(245, 158, 11, 0.24), transparent 40%);
    }

    .spotlight-inner {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding: clamp(18px, 3.6vw, 34px);
      min-height: 360px;
      justify-content: flex-end;
      max-width: calc(100% - 290px);
      position: relative;
      z-index: 2;
    }

    .spotlight-media {
      position: absolute;
      right: 22px;
      top: 50%;
      transform: translateY(-50%);
      width: clamp(184px, 22vw, 240px);
      aspect-ratio: 2/3;
      border-radius: 14px;
      overflow: hidden;
      border: 0;
      background: transparent;
      z-index: 1;
      box-shadow: none;
    }

    .spotlight-media img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: transparent;
    }

    .spotlight.has-square-media .spotlight-inner {
      max-width: calc(100% - 232px);
    }

    .spotlight.has-landscape-media .spotlight-inner {
      max-width: calc(100% - 292px);
    }

    .spotlight-media.square {
      width: clamp(154px, 18vw, 208px);
      aspect-ratio: 1/1;
      border-radius: 16px;
      padding: 0;
      background: transparent;
      display: block;
    }

    .spotlight-media.square img {
      border-radius: 12px;
      object-fit: contain !important;
      background: transparent;
      width: 100%;
      height: 100%;
      padding: 0;
    }

    .spotlight-media.landscape {
      width: clamp(224px, 30vw, 320px);
      aspect-ratio: 16/10;
      border-radius: 16px;
      padding: 0;
      background: transparent;
    }

    .spotlight-media.landscape img {
      object-fit: contain !important;
      background: transparent;
    }

    .spotlight.no-media .spotlight-inner {
      max-width: 760px;
    }

    .spotlight-kicker {
      text-transform: uppercase;
      letter-spacing: 1.1px;
      color: #cfe0ff;
      font-size: 12px;
      font-weight: 700;
      opacity: 0.92;
    }

    .spotlight-title {
      font-size: clamp(31px, 5.2vw, 57px);
      line-height: 1.03;
      letter-spacing: -0.4px;
    }

    .spotlight-summary {
      color: #d7e4ff;
      font-size: 15px;
      line-height: 1.45;
      max-width: 640px;
    }

    .spotlight-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 2px;
    }

    .chip {
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.08);
      color: #d9e7ff;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .spotlight-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 4px;
    }

    .spotlight-dots {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      margin-top: 2px;
    }

    .spotlight-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      border: 0;
      background: rgba(255,255,255,0.36);
      cursor: pointer;
      transition: transform 0.2s ease, background 0.2s ease;
    }

    .spotlight-dot.active {
      background: var(--accent);
      transform: scale(1.2);
    }

    .status {
      font-size: 12px;
      color: var(--ok);
      margin-top: 3px;
      display: none;
    }

    .section {
      background: rgba(19, 35, 71, 0.9);
      border: 1px solid var(--border);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .section-head {
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
    }

    .section-head h2 {
      font-size: 23px;
      margin-bottom: 3px;
      letter-spacing: -0.2px;
    }
    .section-head p { color: var(--muted); font-size: 13px; }

    .rail-wrap { padding: 14px 14px 16px; }

    .rail-title {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      font-size: 15px;
      font-weight: 700;
    }

    .rail-title a {
      color: var(--accent);
      font-size: 12px;
      font-weight: 600;
    }

    .rail {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 156px;
      gap: 11px;
      overflow-x: auto;
      overflow-y: hidden;
      padding-bottom: 6px;
      scroll-snap-type: x mandatory;
      -webkit-overflow-scrolling: touch;
    }

    .rail.unified-rail { grid-auto-columns: 156px; }
    .rail::-webkit-scrollbar { height: 7px; }
    .rail::-webkit-scrollbar-thumb { background: rgba(140,163,199,0.55); border-radius: 999px; }
    .rail.games-rail { grid-auto-columns: 156px; }

    .card {
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      background: var(--card-2);
      scroll-snap-align: start;
      min-height: 232px;
      position: relative;
      transition: border-color 0.2s ease, transform 0.2s ease;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
    }

    .card.menu-open,
    .card.menu-open:hover {
      transform: none;
    }

    .card-media {
      width: 100%;
      aspect-ratio: 2/3;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
      display: grid;
      place-items: center;
      color: var(--muted);
      overflow: hidden;
      position: relative;
    }

    .card-media img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transform: scale(1.001);
    }

    .card-media.landscape { aspect-ratio: 16/10; }

    .card-media.landscape img {
      object-fit: cover;
    }

    .card-media.game-poster {
      aspect-ratio: 2/3;
      padding: 0;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
    }

    .card-media.music-cover {
      aspect-ratio: 1/1;
      padding: 0;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
    }

    .card-media.music-cover img {
      object-fit: cover;
      border-radius: 0;
      background: transparent;
    }

    .card-media.game-poster img {
      object-fit: cover;
      border-radius: 0;
    }

    .card-media.landscape.game-poster img {
      object-fit: cover;
    }

    .card-media.restaurant-composite {
      position: relative;
      display: block;
      background: linear-gradient(135deg, #1a2d5f 0%, #0b1633 100%);
    }

    .card-media.restaurant-composite .restaurant-cover {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .restaurant-logo-badge {
      position: absolute;
      right: 8px;
      bottom: 8px;
      width: 42px;
      height: 42px;
      border-radius: 10px;
      background: rgba(11, 22, 51, 0.92);
      border: 1px solid rgba(245, 158, 11, 0.75);
      padding: 4px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.35);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }

    .card-media .restaurant-logo-badge img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 7px;
    }

    .card-meta {
      padding: 9px;
      display: flex;
      flex-direction: column;
      gap: 3px;
      flex: 1;
    }

    .card-meta-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 2px;
    }

    .card-type {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      color: #dbe7ff;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 999px;
      padding: 3px 8px;
      margin-bottom: 3px;
      width: fit-content;
    }

    .card-name {
      font-size: 13px;
      font-weight: 700;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 36px;
      margin-bottom: 0;
    }

    .card-sub {
      color: var(--muted);
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      min-height: 17px;
    }

    .card-extra {
      margin-top: 4px;
      color: #a9b9da;
      font-size: 12px;
      line-height: 1.35;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 32px;
    }

    .card-extra.placeholder {
      visibility: hidden;
    }

    .rail.unified-rail .card {
      height: 332px;
      min-height: 332px;
    }

    .rail.unified-rail .card-media {
      aspect-ratio: 2/3;
      height: 216px;
      padding: 0;
    }

    .rail.unified-rail .card-media img {
      object-fit: contain;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
    }

    .rail.unified-rail .card-media.restaurant-composite {
      aspect-ratio: 2/3;
    }

    .rail.unified-rail .card-media.restaurant-composite .restaurant-cover {
      object-fit: cover;
    }

    .rail.unified-rail .card-media.game-poster {
      aspect-ratio: 2/3;
      height: 216px;
      padding: 0;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
    }

    .rail.unified-rail .card-media.game-poster img {
      object-fit: cover;
      border-radius: 0;
    }

    .rail.unified-rail .card-media.music-cover img {
      object-fit: cover;
      background: transparent;
    }

    .rail.games-rail .card {
      height: 332px;
      min-height: 332px;
      display: flex;
      flex-direction: column;
    }

    .rail.games-rail .card-meta {
      display: flex;
      flex-direction: column;
      flex: 1;
    }

    .rail.games-rail .card-media.game-poster {
      aspect-ratio: 2/3;
      height: 216px;
      padding: 0;
      background: linear-gradient(135deg, #0e1f42 0%, #0c1a3b 100%);
    }

    .rail.games-rail .card-media.game-poster img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0;
      background: transparent;
    }

    .card-menu-wrap {
      position: relative;
      flex-shrink: 0;
    }

    .card-menu-btn {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(19, 35, 71, 0.92);
      color: var(--white);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: border-color 0.2s ease, color 0.2s ease;
    }

    .card-menu-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .card-menu-btn.active {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(245, 158, 11, 0.15);
    }

    .card-open-link {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: rgba(19, 35, 71, 0.92);
      color: #d4e2ff;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .rail-menu {
      position: fixed;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: min(94vw, 400px);
      border-radius: 14px;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 12px;
      display: none;
      z-index: 3300;
    }

    .rail-menu.open {
      display: block;
    }

    .rail-menu-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      backdrop-filter: blur(4px);
      z-index: 3290;
      display: none;
    }

    .rail-menu-backdrop.active {
      display: block;
    }

    .rail-menu-item {
      width: 100%;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--white);
      border-radius: 11px;
      padding: 12px 14px;
      font-size: 14px;
      text-align: left;
      cursor: pointer;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      transition: all 0.2s ease;
    }

    .rail-menu-item:last-child {
      margin-bottom: 0;
    }

    .rail-menu-item:hover {
      border-color: var(--accent);
      background: rgba(245, 158, 11, 0.1);
    }

    .rail-menu-item.saved {
      border-color: var(--accent);
      background: rgba(245, 158, 11, 0.15);
      color: var(--accent);
    }

    .rail-menu-item.saved .rail-menu-state {
      color: var(--accent);
    }

    .rail-menu-title {
      color: var(--muted);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      padding: 2px 2px 10px;
    }

    .rail-menu-item-main {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .rail-menu-state {
      color: var(--white);
      opacity: 0.9;
      font-weight: 600;
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.1);
    }

    .modal {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(6, 12, 28, 0.85);
      backdrop-filter: blur(5px);
      z-index: 3400;
      padding: 16px;
    }

    .modal.active { display: flex; }

    .modal-content {
      width: min(420px, 100%);
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 20px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 700;
    }

    .modal-close {
      background: transparent;
      border: 0;
      color: var(--muted);
      font-size: 24px;
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
    }

    .modal-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--white);
    }

    .modal-list {
      display: grid;
      gap: 10px;
      max-height: 300px;
      overflow-y: auto;
      padding: 6px 0;
      margin-bottom: 16px;
    }

    .modal-list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .modal-list-item:hover {
      border-color: var(--accent);
      background: rgba(245, 158, 11, 0.08);
    }

    .modal-list-item.active {
      border-color: var(--accent);
      background: rgba(245, 158, 11, 0.15);
    }

    .modal-list-actions {
      display: inline-flex;
      gap: 8px;
      align-items: center;
      color: var(--muted);
      font-size: 13px;
    }

    .list-edit-btn {
      border: 0;
      background: transparent;
      color: var(--muted);
      cursor: pointer;
      width: 30px;
      height: 30px;
      border-radius: 6px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .list-edit-btn:hover { 
      color: var(--accent);
      background: rgba(255,255,255,0.1);
    }

    .modal-input {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .modal-input input {
      flex: 1;
      height: 42px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card-2);
      color: var(--white);
      padding: 0 12px;
      font-size: 14px;
    }

    .modal-input input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .icon-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      padding: 8px 0;
    }

    .icon-option {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--card-2);
      color: var(--white);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 16px;
    }

    .icon-option:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .icon-option.selected {
      border-color: var(--accent);
      color: var(--accent);
      background: rgba(245, 158, 11, 0.15);
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .empty-state {
      border: 1px dashed var(--border);
      background: rgba(255,255,255,0.02);
      color: var(--muted);
      border-radius: 12px;
      text-align: center;
      padding: 24px 16px;
      font-size: 14px;
    }

    .mobile-bottom-nav {
      display: none;
    }

    .spotlight-fade {
      animation: spotlightFade 0.32s ease;
    }

    @keyframes spotlightFade {
      from { opacity: 0.45; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 1100px) {
      .top-nav {
        flex-wrap: wrap;
        justify-content: flex-end;
      }
    }

    @media (max-width: 860px) {
      .top-nav {
        display: none;
      }
      .header-actions {
        margin-left: auto;
      }
    }

    @media (max-width: 760px) {
      body {
        padding-bottom: 86px;
      }

      .container { width: calc(100% - 16px); }
      .header-inner { gap: 10px; }
      .brand { font-size: 18px; }
      .brand img { width: 31px; height: 31px; }
      .search-wrap { order: 3; max-width: none; margin-left: 0; width: 100%; }
      .header-actions { margin-left: auto; }
      .auth-actions .btn {
        height: 36px;
        padding: 0 10px;
        border-radius: 11px;
      }
      #profileBtn span {
        display: none;
      }

      .spotlight { border-radius: 18px; min-height: 332px; }
      .spotlight-media {
        right: 12px;
        top: 12px;
        transform: none;
        width: 96px;
        aspect-ratio: 2/3;
        margin: 0;
        border-radius: 12px;
      }
      .spotlight-inner {
        min-height: 332px;
        max-width: none;
        padding: 14px 16px 16px;
        padding-right: 120px;
        gap: 9px;
      }
      .spotlight.no-media .spotlight-inner {
        padding-right: 16px;
      }

      .spotlight.has-square-media .spotlight-inner {
        padding-right: 112px;
      }

      .spotlight.has-landscape-media .spotlight-inner {
        padding-right: 16px;
        padding-top: 118px;
      }

      .spotlight-media.square {
        width: 88px;
        aspect-ratio: 1/1;
        padding: 0;
        border-radius: 12px;
        background: transparent;
      }

      .spotlight-media.square img {
        width: 100%;
        height: 100%;
        object-fit: contain !important;
        padding: 0;
        border-radius: 12px;
        background: transparent;
      }

      .spotlight-media.landscape {
        width: min(46vw, 184px);
        max-width: 184px;
        height: auto;
        aspect-ratio: 16/9;
        right: 12px;
        left: auto;
        top: 12px;
        border-radius: 12px;
        padding: 0;
        background: transparent;
      }

      .spotlight-media.landscape img {
        object-fit: contain !important;
        width: 100%;
        height: 100%;
        background: transparent;
      }

      .spotlight.has-landscape-media .spotlight-title {
        font-size: clamp(20px, 6vw, 32px);
      }

      .spotlight.has-landscape-media .spotlight-summary {
        font-size: 12px;
        -webkit-line-clamp: 2;
      }

      .spotlight-title {
        font-size: clamp(24px, 8vw, 38px);
      }

      .spotlight-summary {
        font-size: 13px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .spotlight-meta {
        display: grid;
        grid-template-columns: 1fr;
        gap: 6px;
        width: 100%;
      }

      .spotlight-meta .chip {
        display: flex;
        width: 100%;
        white-space: normal;
        overflow: visible;
        text-overflow: clip;
        max-width: none;
        font-size: 11px;
        line-height: 1.25;
        padding: 7px 9px;
        align-items: flex-start;
        gap: 7px;
      }

      .spotlight-meta .chip i {
        flex-shrink: 0;
        margin-top: 1px;
      }

      .spotlight-actions {
        gap: 8px;
      }

      .section { border-radius: 16px; }
      .section-head h2 { font-size: 19px; }
      .rail { grid-auto-columns: 142px; }
      .rail.unified-rail { grid-auto-columns: 142px; }
      .rail.games-rail { grid-auto-columns: 142px; }
      .card { min-height: 232px; }
      .card-hover-cue { display: none; }

      .rail.unified-rail .card {
        height: 314px;
        min-height: 314px;
      }

      .rail.unified-rail .card-media {
        height: 190px;
        aspect-ratio: 2/3;
      }

      .rail.unified-rail .card-media.game-poster {
        height: 190px;
        aspect-ratio: 2/3;
        padding: 0;
      }

      .rail.unified-rail .card-media.game-poster img {
        object-fit: cover;
        border-radius: 0;
      }

      .rail.unified-rail .card-media.music-cover img {
        object-fit: cover;
      }

      .rail.games-rail .card {
        height: 314px;
        min-height: 314px;
      }

      .rail.games-rail .card-media.game-poster {
        height: 190px;
        aspect-ratio: 2/3;
        padding: 0;
      }

      .rail.games-rail .card-media.game-poster img {
        object-fit: cover;
        border-radius: 0;
      }

      .rail.unified-rail .card-media.restaurant-composite {
        aspect-ratio: 2/3;
      }

      #restaurantsRail .card-media.restaurant-composite {
        aspect-ratio: 16/10;
      }

      #restaurantsRail .restaurant-logo-badge {
        width: 36px;
        height: 36px;
        right: 7px;
        bottom: 7px;
        border-radius: 9px;
      }

      .mobile-bottom-nav {
        position: fixed;
        left: 10px;
        right: 10px;
        bottom: 10px;
        display: grid;
        grid-template-columns: repeat(7, minmax(0, 1fr));
        border: 1px solid var(--border);
        border-radius: 18px;
        background: rgba(12, 24, 52, 0.95);
        backdrop-filter: blur(12px);
        box-shadow: 0 10px 34px rgba(0,0,0,0.35);
        z-index: 230;
        padding: 6px;
      }

      .mobile-nav-item {
        min-height: 48px;
        border-radius: 12px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: #c8d7f6;
        font-size: 18px;
        transition: color 0.2s ease, background 0.2s ease;
      }

      .mobile-nav-item.active,
      .mobile-nav-item:hover {
        color: var(--accent);
        background: rgba(245, 158, 11, 0.16);
      }

      .rail-menu {
        width: 90vw;
        max-width: 380px;
        padding: 16px;
      }

      .rail-menu-item {
        padding: 14px 16px;
        font-size: 15px;
      }

      .modal-content {
        padding: 16px;
      }
    }

    .toast-message {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      background: var(--card);
      border: 1px solid var(--border);
      color: var(--white);
      padding: 12px 24px;
      border-radius: 999px;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 10px 24px rgba(0,0,0,0.35);
      animation: toastFade 2.5s ease forwards;
      white-space: nowrap;
      max-width: 90vw;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .toast-message.success { background: var(--ok); color: white; border-color: var(--ok); }
    .toast-message.error { background: #dc2626; color: white; border-color: #dc2626; }

    @keyframes toastFade {
      0% { opacity: 0; transform: translate(-50%, 20px); }
      15% { opacity: 1; transform: translate(-50%, 0); }
      85% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, -20px); }
    }
  </style>
  <meta name="theme-color" content="#0b1633" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Zo2y" />
  <link rel="apple-touch-icon" href="/images/logo.png" />
</head>
<body>
  <header>
    <div class="container header-inner">
      <a class="brand" href="index.html">
        <img src="images/logo.png" alt="Zo2y" />
        <span>Zo2y</span>
      </a>

      <div class="search-wrap">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input class="search" id="globalSearch" placeholder="Search all media..." />
      </div>

      <div class="header-actions">
        <nav class="top-nav" aria-label="Browse media">
          <a class="nav-pill" href="movies.html">Movies</a>
          <a class="nav-pill" href="tvshows.html">TV</a>
          <a class="nav-pill" href="games.html">Games</a>
          <a class="nav-pill" href="books.html">Books</a>
          <a class="nav-pill" href="music.html">Music</a>
          <a class="nav-pill" href="restraunts.html">Restaurants</a>
        </nav>
        <div class="auth-actions">
          <a class="btn" href="login.html" id="loginBtn">Login</a>
          <a class="btn btn-primary" href="sign-up.html" id="signupBtn">Sign Up</a>
          <a class="btn" href="profile.html" id="profileBtn" style="display:none;">Profile</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container page-shell">
    <section class="spotlight" id="spotlightSection">
      <div class="spotlight-bg" id="spotlightBackground"></div>
      <div class="spotlight-media" id="spotlightMedia">
        <img id="spotlightImage" alt="Spotlight artwork" loading="eager" fetchpriority="high" />
      </div>
      <div class="spotlight-inner" id="spotlightInner">
        <p class="spotlight-kicker" id="spotlightKicker">Live Spotlight</p>
        <h1 class="spotlight-title" id="spotlightTitle">Loading spotlight...</h1>
        <p class="spotlight-summary" id="spotlightSummary">Pulling trends and personalization signals.</p>
        <div class="spotlight-meta">
          <span class="chip" id="spotlightReason"><i class="fa-solid fa-compass"></i> Discovery engine warming up</span>
          <span class="chip" id="spotlightTrend"><i class="fa-solid fa-bolt"></i> Global buzz sync</span>
        </div>
        <div class="spotlight-actions">
          <a class="btn btn-primary" href="movies.html" id="spotlightOpenBtn"><i class="fa-solid fa-play"></i> Open</a>
          <button class="btn" id="spotlightNextBtn" type="button"><i class="fa-solid fa-forward"></i> Next Pulse</button>
        </div>
        <div class="spotlight-dots" id="spotlightDots" aria-label="Spotlight items"></div>
        <div class="status" id="loadStatus">Loading live feed...</div>
      </div>
    </section>

    <section class="section">
      <div class="section-head">
        <h2>Culture Stream</h2>
        <p>One swipeable feed blending movies, TV, games, books, music, and restaurants.</p>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-wave-square"></i> Mixed for you</span><a href="profile.html">Tune taste</a></div>
        <div class="rail unified-rail" id="unifiedRail"></div>
      </div>
    </section>

    <section class="section">
      <div class="section-head">
        <h2>Trending by Category</h2>
        <p>Dive into a lane when you want focused browsing.</p>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-utensils"></i> Restaurants</span><a href="restraunts.html">View all</a></div>
        <div class="rail" id="restaurantsRail"></div>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-film"></i> Movies</span><a href="movies.html">View all</a></div>
        <div class="rail" id="moviesRail"></div>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-tv"></i> TV Shows</span><a href="tvshows.html">View all</a></div>
        <div class="rail" id="tvRail"></div>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-gamepad"></i> Games</span><a href="games.html">View all</a></div>
        <div class="rail" id="gamesRail"></div>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-book"></i> Books</span><a href="books.html">View all</a></div>
        <div class="rail" id="booksRail"></div>
      </div>

      <div class="rail-wrap">
        <div class="rail-title"><span><i class="fa-solid fa-music"></i> Music</span><a href="music.html">View all</a></div>
        <div class="rail" id="musicRail"></div>
      </div>

    </section>
  </main>

  <nav class="mobile-bottom-nav" aria-label="Mobile sections">
    <a class="mobile-nav-item active" href="index.html" aria-label="Home"><i class="fa-solid fa-house"></i></a>
    <a class="mobile-nav-item" href="movies.html" aria-label="Movies"><i class="fa-solid fa-film"></i></a>
    <a class="mobile-nav-item" href="tvshows.html" aria-label="TV Shows"><i class="fa-solid fa-tv"></i></a>
    <a class="mobile-nav-item" href="games.html" aria-label="Games"><i class="fa-solid fa-gamepad"></i></a>
    <a class="mobile-nav-item" href="books.html" aria-label="Books"><i class="fa-solid fa-book"></i></a>
    <a class="mobile-nav-item" href="music.html" aria-label="Music"><i class="fa-solid fa-music"></i></a>
    <a class="mobile-nav-item" href="restraunts.html" aria-label="Restaurants"><i class="fa-solid fa-utensils"></i></a>
  </nav>

  <div class="modal" id="homeListsModal" aria-hidden="true">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="homeListsTitle">Custom Lists</div>
        <button class="modal-close" id="closeHomeListsBtn" aria-label="Close">&times;</button>
      </div>
      <div class="modal-list" id="homeListsContainer"></div>
      <div class="modal-input">
        <input type="text" id="newHomeListName" placeholder="New list name..." maxlength="50">
        <button class="btn" id="createHomeListBtn">Create</button>
      </div>
      <div class="icon-options" id="homeListIconOptions">
        <button class="icon-option selected" data-icon="fas fa-list"><i class="fas fa-list"></i></button>
        <button class="icon-option" data-icon="fas fa-film"><i class="fas fa-film"></i></button>
        <button class="icon-option" data-icon="fas fa-tv"><i class="fas fa-tv"></i></button>
        <button class="icon-option" data-icon="fas fa-gamepad"><i class="fas fa-gamepad"></i></button>
        <button class="icon-option" data-icon="fas fa-book"><i class="fas fa-book"></i></button>
        <button class="icon-option" data-icon="fas fa-music"><i class="fas fa-music"></i></button>
        <button class="icon-option" data-icon="fas fa-heart"><i class="fas fa-heart"></i></button>
        <button class="icon-option" data-icon="fas fa-star"><i class="fas fa-star"></i></button>
        <button class="icon-option" data-icon="fas fa-bookmark"><i class="fas fa-bookmark"></i></button>
        <button class="icon-option" data-icon="fas fa-utensils"><i class="fas fa-utensils"></i></button>
      </div>
      <div class="modal-actions">
        <button class="btn" id="saveHomeListsBtn">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="rail-menu-backdrop" id="railMenuBackdrop"></div>

  <script>
    // Configuration
    const SUPABASE_URL = 'https://gfkhjbztayjyojsgdpgk.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdma2hqYnp0YXlqeW9qc2dkcGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTYyNjQsImV4cCI6MjA3NTY3MjI2NH0.WUb2yDAwCeokdpWCPeH13FE8NhWF6G8e6ivTsgu6b2s';
    const TMDB_POSTER = 'https://image.tmdb.org/t/p/w500';
    const TMDB_BACKDROP = 'https://image.tmdb.org/t/p/w1280';
    
    // Global state
    let supabase = null;
    let currentUser = null;
    let spotlightItems = [];
    let spotlightIndex = 0;
    let spotlightTimer = null;
    let menuOpen = false;
    let activeMenuCard = null;
    let customListState = {
      mediaType: null,
      itemId: null,
      title: '',
      subtitle: '',
      image: '',
      customLists: [],
      selectedIcon: 'fas fa-list',
      selectedLists: new Set()
    };

    // Initialize Supabase
    async function initSupabase() {
      if (supabase) return supabase;
      if (!window.supabase) {
        console.error('Supabase not loaded');
        return null;
      }
      supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY, {
        auth: {
          flowType: 'pkce',
          persistSession: true,
          autoRefreshToken: true,
          detectSessionInUrl: false
        }
      });
      return supabase;
    }

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast-message ${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 2500);
    }

    // Get current user
    async function getCurrentUser() {
      const client = await initSupabase();
      if (!client) return null;
      
      try {
        const { data: { session } } = await client.auth.getSession();
        if (session?.user) {
          currentUser = session.user;
          return currentUser;
        }
      } catch (err) {
        console.error('Error getting user:', err);
      }
      return null;
    }

    // Update auth UI
    async function updateAuthUI() {
      const user = await getCurrentUser();
      const loginBtn = document.getElementById('loginBtn');
      const signupBtn = document.getElementById('signupBtn');
      const profileBtn = document.getElementById('profileBtn');
      
      if (user) {
        if (loginBtn) loginBtn.style.display = 'none';
        if (signupBtn) signupBtn.style.display = 'none';
        if (profileBtn) {
          profileBtn.innerHTML = '<i class="fas fa-user"></i><span>Profile</span>';
          profileBtn.style.display = 'inline-flex';
        }
      } else {
        if (loginBtn) loginBtn.style.display = 'inline-flex';
        if (signupBtn) signupBtn.style.display = 'inline-flex';
        if (profileBtn) profileBtn.style.display = 'none';
      }
    }

    // Save to list
    async function saveToList(mediaType, itemId, listType, itemData = {}) {
      const user = await getCurrentUser();
      if (!user) {
        showToast('Please login first', 'error');
        window.location.href = 'login.html';
        return false;
      }

      const client = await initSupabase();
      if (!client) {
        showToast('Service unavailable', 'error');
        return false;
      }

      try {
        switch (mediaType) {
          case 'movie': {
            const { data: existing } = await client
              .from('movie_list_items')
              .select('id')
              .eq('user_id', user.id)
              .eq('movie_id', itemId)
              .eq('list_type', listType)
              .maybeSingle();
            
            if (existing) {
              await client.from('movie_list_items').delete().eq('id', existing.id);
              showToast('Removed from list');
            } else {
              await client.from('movie_list_items').insert({
                user_id: user.id,
                movie_id: itemId,
                list_type: listType
              });
              showToast('Added to list');
            }
            break;
          }

          case 'tv': {
            const { data: existing } = await client
              .from('tv_list_items')
              .select('id')
              .eq('user_id', user.id)
              .eq('tv_id', itemId)
              .eq('list_type', listType)
              .maybeSingle();
            
            if (existing) {
              await client.from('tv_list_items').delete().eq('id', existing.id);
              showToast('Removed from list');
            } else {
              await client.from('tv_list_items').insert({
                user_id: user.id,
                tv_id: itemId,
                list_type: listType
              });
              showToast('Added to list');
            }
            break;
          }

          case 'game': {
            const { data: existing } = await client
              .from('game_list_items')
              .select('id')
              .eq('user_id', user.id)
              .eq('game_id', itemId)
              .eq('list_type', listType)
              .maybeSingle();
            
            if (existing) {
              await client.from('game_list_items').delete().eq('id', existing.id);
              showToast('Removed from list');
            } else {
              await client.from('game_list_items').insert({
                user_id: user.id,
                game_id: itemId,
                list_type: listType
              });
              showToast('Added to list');
            }
            break;
          }

          case 'book': {
            if (itemData.title) {
              await client.from('books').upsert({
                id: itemId,
                title: itemData.title,
                authors: itemData.subtitle || '',
                thumbnail: itemData.image || '',
                updated_at: new Date().toISOString()
              }, { onConflict: 'id' });
            }
            
            const { data: existing } = await client
              .from('book_list_items')
              .select('id')
              .eq('user_id', user.id)
              .eq('book_id', itemId)
              .eq('list_type', listType)
              .maybeSingle();
            
            if (existing) {
              await client.from('book_list_items').delete().eq('id', existing.id);
              showToast('Removed from list');
            } else {
              await client.from('book_list_items').insert({
                user_id: user.id,
                book_id: itemId,
                list_type: listType
              });
              showToast('Added to list');
            }
            break;
          }

          case 'music': {
            if (itemData.title) {
              await client.from('tracks').upsert({
                id: itemId,
                name: itemData.title,
                artists: itemData.subtitle || '',
                image_url: itemData.image || '',
                updated_at: new Date().toISOString()
              }, { onConflict: 'id' });
            }
            
            const { data: existing } = await client
              .from('music_list_items')
              .select('id')
              .eq('user_id', user.id)
              .eq('track_id', itemId)
              .eq('list_type', listType)
              .maybeSingle();
            
            if (existing) {
              await client.from('music_list_items').delete().eq('id', existing.id);
              showToast('Removed from list');
            } else {
              await client.from('music_list_items').insert({
                user_id: user.id,
                track_id: itemId,
                list_type: listType
              });
              showToast('Added to list');
            }
            break;
          }

          case 'restaurant': {
            // Get or create list
            let listId;
            const listTitle = listType === 'favorites' ? 'Favorites' : 
                             listType === 'visited' ? 'Visited' : 'Want to Go';
            
            const { data: existingList } = await client
              .from('lists')
              .select('id')
              .eq('user_id', user.id)
              .eq('title', listTitle)
              .maybeSingle();
            
            if (existingList) {
              listId = existingList.id;
            } else {
              const { data: newList } = await client
                .from('lists')
                .insert({
                  user_id: user.id,
                  title: listTitle,
                  description: `My ${listTitle.toLowerCase()} restaurants`,
                  icon: listType
                })
                .select('id')
                .single();
              listId = newList?.id;
            }
            
            if (listId) {
              const { data: existing } = await client
                .from('lists_restraunts')
                .select('id')
                .eq('list_id', listId)
                .eq('restraunt_id', itemId)
                .maybeSingle();
              
              if (existing) {
                await client.from('lists_restraunts').delete().eq('id', existing.id);
                showToast('Removed from list');
              } else {
                await client.from('lists_restraunts').insert({
                  list_id: listId,
                  restraunt_id: itemId
                });
                showToast('Added to list');
              }
            }
            break;
          }
        }
        return true;
      } catch (err) {
        console.error('Error saving to list:', err);
        showToast('Error saving to list', 'error');
        return false;
      }
    }

    // Get list status
    async function getListStatus(mediaType, itemId) {
      const user = await getCurrentUser();
      if (!user) return new Set();
      
      const client = await initSupabase();
      if (!client) return new Set();
      
      const saved = new Set();
      
      try {
        switch (mediaType) {
          case 'movie': {
            const { data } = await client
              .from('movie_list_items')
              .select('list_type')
              .eq('user_id', user.id)
              .eq('movie_id', itemId);
            (data || []).forEach(row => saved.add(row.list_type));
            break;
          }
          case 'tv': {
            const { data } = await client
              .from('tv_list_items')
              .select('list_type')
              .eq('user_id', user.id)
              .eq('tv_id', itemId);
            (data || []).forEach(row => saved.add(row.list_type));
            break;
          }
          case 'game': {
            const { data } = await client
              .from('game_list_items')
              .select('list_type')
              .eq('user_id', user.id)
              .eq('game_id', itemId);
            (data || []).forEach(row => saved.add(row.list_type));
            break;
          }
          case 'book': {
            const { data } = await client
              .from('book_list_items')
              .select('list_type')
              .eq('user_id', user.id)
              .eq('book_id', itemId);
            (data || []).forEach(row => saved.add(row.list_type));
            break;
          }
          case 'music': {
            const { data } = await client
              .from('music_list_items')
              .select('list_type')
              .eq('user_id', user.id)
              .eq('track_id', itemId);
            (data || []).forEach(row => saved.add(row.list_type));
            break;
          }
          case 'restaurant': {
            const { data: lists } = await client
              .from('lists')
              .select('id,title')
              .eq('user_id', user.id);
            
            const listMap = {};
            lists?.forEach(list => {
              if (list.title === 'Favorites') listMap.favorites = list.id;
              if (list.title === 'Visited') listMap.visited = list.id;
              if (list.title === 'Want to Go') listMap.wantToGo = list.id;
            });
            
            const listIds = Object.values(listMap);
            if (listIds.length) {
              const { data: links } = await client
                .from('lists_restraunts')
                .select('list_id')
                .eq('restraunt_id', itemId)
                .in('list_id', listIds);
              
              (links || []).forEach(link => {
                if (link.list_id === listMap.favorites) saved.add('favorites');
                if (link.list_id === listMap.visited) saved.add('visited');
                if (link.list_id === listMap.wantToGo) saved.add('wantToGo');
              });
            }
            break;
          }
        }
      } catch (err) {
        console.error('Error getting list status:', err);
      }
      
      return saved;
    }

    // Update menu button states
    async function updateMenuStates(menu, mediaType, itemId) {
      const saved = await getListStatus(mediaType, itemId);
      
      menu.querySelectorAll('.rail-menu-item[data-action="save"]').forEach(btn => {
        const listType = btn.getAttribute('data-list');
        const isSaved = saved.has(listType);
        btn.classList.toggle('saved', isSaved);
        const stateEl = btn.querySelector('.rail-menu-state');
        if (stateEl) stateEl.textContent = isSaved ? 'Saved' : 'Add';
      });
    }

    // Close all menus
    function closeAllMenus() {
      document.querySelectorAll('.rail-menu.open').forEach(menu => {
        menu.classList.remove('open');
      });
      document.querySelectorAll('.card.menu-open').forEach(card => {
        card.classList.remove('menu-open');
      });
      document.querySelectorAll('.card-menu-btn.active').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById('railMenuBackdrop')?.classList.remove('active');
      menuOpen = false;
      activeMenuCard = null;
    }

    // Open menu
    async function openMenu(btn, card) {
      if (menuOpen) closeAllMenus();
      
      const menu = btn.parentElement.querySelector('.rail-menu');
      if (!menu) return;
      
      btn.classList.add('active');
      card.classList.add('menu-open');
      menu.classList.add('open');
      
      const mediaType = card.getAttribute('data-media-type');
      const itemId = card.getAttribute('data-item-id');
      
      if (mediaType && itemId) {
        await updateMenuStates(menu, mediaType, itemId);
      }
      
      document.getElementById('railMenuBackdrop')?.classList.add('active');
      menuOpen = true;
      activeMenuCard = card;
    }

    // Load custom lists
    async function loadCustomLists(mediaType) {
      const user = await getCurrentUser();
      if (!user) return [];
      
      const client = await initSupabase();
      if (!client) return [];
      
      try {
        const { data } = await client
          .from('lists')
          .select('*')
          .eq('user_id', user.id)
          .eq('media_type', mediaType)
          .order('created_at', { ascending: false });
        
        return data || [];
      } catch (err) {
        console.error('Error loading custom lists:', err);
        return [];
      }
    }

    // Load custom list membership
    async function loadCustomListMembership(mediaType, itemId, listIds) {
      const user = await getCurrentUser();
      if (!user || !listIds.length) return new Set();
      
      const client = await initSupabase();
      if (!client) return new Set();
      
      const saved = new Set();
      
      try {
        const table = mediaType === 'movie' ? 'movie_list_items' :
                     mediaType === 'tv' ? 'tv_list_items' :
                     mediaType === 'game' ? 'game_list_items' :
                     mediaType === 'book' ? 'book_list_items' :
                     mediaType === 'music' ? 'music_list_items' : null;
        
        if (table) {
          const { data } = await client
            .from(table)
            .select('list_id')
            .eq('user_id', user.id)
            .eq(mediaType === 'movie' ? 'movie_id' :
                mediaType === 'tv' ? 'tv_id' :
                mediaType === 'game' ? 'game_id' :
                mediaType === 'book' ? 'book_id' : 'track_id', itemId)
            .in('list_id', listIds);
          
          (data || []).forEach(row => saved.add(row.list_id));
        } else if (mediaType === 'restaurant') {
          const { data } = await client
            .from('lists_restraunts')
            .select('list_id')
            .eq('restraunt_id', itemId)
            .in('list_id', listIds);
          
          (data || []).forEach(row => saved.add(row.list_id));
        }
      } catch (err) {
        console.error('Error loading custom list membership:', err);
      }
      
      return saved;
    }

    // Create custom list
    async function createCustomList(mediaType, title, icon) {
      const user = await getCurrentUser();
      if (!user) {
        showToast('Please login first', 'error');
        return null;
      }
      
      const client = await initSupabase();
      if (!client) return null;
      
      try {
        const { data, error } = await client
          .from('lists')
          .insert({
            user_id: user.id,
            media_type: mediaType,
            title: title,
            icon: icon,
            description: `My ${title} list`
          })
          .select()
          .single();
        
        if (error) throw error;
        showToast('List created');
        return data;
      } catch (err) {
        console.error('Error creating list:', err);
        showToast('Error creating list', 'error');
        return null;
      }
    }

    // Save to custom list
    async function saveToCustomList(mediaType, listId, itemId, itemData) {
      const user = await getCurrentUser();
      if (!user) {
        showToast('Please login first', 'error');
        return false;
      }
      
      const client = await initSupabase();
      if (!client) return false;
      
      try {
        // Save media item first if needed
        if (mediaType === 'book' && itemData.title) {
          await client.from('books').upsert({
            id: itemId,
            title: itemData.title,
            authors: itemData.subtitle || '',
            thumbnail: itemData.image || '',
            updated_at: new Date().toISOString()
          }, { onConflict: 'id' });
        } else if (mediaType === 'music' && itemData.title) {
          await client.from('tracks').upsert({
            id: itemId,
            name: itemData.title,
            artists: itemData.subtitle || '',
            image_url: itemData.image || '',
            updated_at: new Date().toISOString()
          }, { onConflict: 'id' });
        }
        
        // Check if already in list
        let existing;
        if (mediaType === 'restaurant') {
          const { data } = await client
            .from('lists_restraunts')
            .select('id')
            .eq('list_id', listId)
            .eq('restraunt_id', itemId)
            .maybeSingle();
          existing = data;
        } else {
          const table = mediaType === 'movie' ? 'movie_list_items' :
                       mediaType === 'tv' ? 'tv_list_items' :
                       mediaType === 'game' ? 'game_list_items' :
                       mediaType === 'book' ? 'book_list_items' : 'music_list_items';
          
          const idField = mediaType === 'movie' ? 'movie_id' :
                         mediaType === 'tv' ? 'tv_id' :
                         mediaType === 'game' ? 'game_id' :
                         mediaType === 'book' ? 'book_id' : 'track_id';
          
          const { data } = await client
            .from(table)
            .select('id')
            .eq('user_id', user.id)
            .eq('list_id', listId)
            .eq(idField, itemId)
            .maybeSingle();
          existing = data;
        }
        
        if (existing) {
          // Remove from list
          if (mediaType === 'restaurant') {
            await client.from('lists_restraunts').delete().eq('id', existing.id);
          } else {
            const table = mediaType === 'movie' ? 'movie_list_items' :
                         mediaType === 'tv' ? 'tv_list_items' :
                         mediaType === 'game' ? 'game_list_items' :
                         mediaType === 'book' ? 'book_list_items' : 'music_list_items';
            await client.from(table).delete().eq('id', existing.id);
          }
          showToast('Removed from list');
          return 'removed';
        } else {
          // Add to list
          if (mediaType === 'restaurant') {
            await client.from('lists_restraunts').insert({
              list_id: listId,
              restraunt_id: itemId
            });
          } else {
            const table = mediaType === 'movie' ? 'movie_list_items' :
                         mediaType === 'tv' ? 'tv_list_items' :
                         mediaType === 'game' ? 'game_list_items' :
                         mediaType === 'book' ? 'book_list_items' : 'music_list_items';
            
            const idField = mediaType === 'movie' ? 'movie_id' :
                           mediaType === 'tv' ? 'tv_id' :
                           mediaType === 'game' ? 'game_id' :
                           mediaType === 'book' ? 'book_id' : 'track_id';
            
            await client.from(table).insert({
              user_id: user.id,
              list_id: listId,
              [idField]: itemId
            });
          }
          showToast('Added to list');
          return 'added';
        }
      } catch (err) {
        console.error('Error saving to custom list:', err);
        showToast('Error saving to list', 'error');
        return false;
      }
    }

    // Open custom lists modal
    async function openCustomListsModal(mediaType, itemId, title, subtitle, image) {
      const user = await getCurrentUser();
      if (!user) {
        showToast('Please login first', 'error');
        window.location.href = 'login.html';
        return;
      }
      
      customListState.mediaType = mediaType;
      customListState.itemId = itemId;
      customListState.title = title;
      customListState.subtitle = subtitle;
      customListState.image = image;
      
      // Load custom lists
      customListState.customLists = await loadCustomLists(mediaType);
      
      // Load membership
      const listIds = customListState.customLists.map(l => l.id);
      customListState.selectedLists = await loadCustomListMembership(mediaType, itemId, listIds);
      
      // Update modal title
      const titleMap = {
        movie: 'Custom Movie Lists',
        tv: 'Custom TV Lists',
        game: 'Custom Game Lists',
        book: 'Custom Book Lists',
        music: 'Custom Music Lists',
        restaurant: 'Custom Restaurant Lists'
      };
      document.getElementById('homeListsTitle').textContent = titleMap[mediaType] || 'Custom Lists';
      
      // Render lists
      renderCustomListsModal();
      
      // Show modal
      document.getElementById('homeListsModal').classList.add('active');
    }

    // Render custom lists modal
    function renderCustomListsModal() {
      const container = document.getElementById('homeListsContainer');
      if (!container) return;
      
      if (!customListState.customLists.length) {
        container.innerHTML = '<div class="empty-state">No custom lists yet. Create one below.</div>';
        return;
      }
      
      container.innerHTML = customListState.customLists.map(list => {
        const isActive = customListState.selectedLists.has(list.id);
        return `
          <div class="modal-list-item${isActive ? ' active' : ''}" data-list-id="${list.id}">
            <span><i class="${list.icon || 'fas fa-list'}"></i> ${list.title}</span>
            <span class="modal-list-actions">
              <span>${isActive ? 'Saved' : 'Add'}</span>
              <button class="list-edit-btn" onclick="event.stopPropagation(); renameList('${list.id}', '${list.title}')">
                <i class="fas fa-pen"></i>
              </button>
            </span>
          </div>
        `;
      }).join('');
      
      // Add click handlers
      container.querySelectorAll('.modal-list-item').forEach(item => {
        item.addEventListener('click', async () => {
          const listId = item.getAttribute('data-list-id');
          const result = await saveToCustomList(
            customListState.mediaType,
            listId,
            customListState.itemId,
            {
              title: customListState.title,
              subtitle: customListState.subtitle,
              image: customListState.image
            }
          );
          
          if (result === 'added') {
            customListState.selectedLists.add(listId);
            item.classList.add('active');
            item.querySelector('.modal-list-actions span').textContent = 'Saved';
          } else if (result === 'removed') {
            customListState.selectedLists.delete(listId);
            item.classList.remove('active');
            item.querySelector('.modal-list-actions span').textContent = 'Add';
          }
        });
      });
    }

    // Rename list
    async function renameList(listId, currentTitle) {
      const newTitle = prompt('Rename list', currentTitle);
      if (!newTitle || !newTitle.trim()) return;
      
      const user = await getCurrentUser();
      if (!user) return;
      
      const client = await initSupabase();
      if (!client) return;
      
      try {
        const { error } = await client
          .from('lists')
          .update({ title: newTitle.trim() })
          .eq('id', listId)
          .eq('user_id', user.id);
        
        if (error) throw error;
        
        // Update local state
        const list = customListState.customLists.find(l => l.id === listId);
        if (list) list.title = newTitle.trim();
        
        renderCustomListsModal();
        showToast('List renamed');
      } catch (err) {
        console.error('Error renaming list:', err);
        showToast('Error renaming list', 'error');
      }
    }

    // Setup card interactions
    function setupCardInteractions(container) {
      if (!container) container = document;
      
      // Card click
      container.querySelectorAll('.card').forEach(card => {
        card.addEventListener('click', (e) => {
          if (e.target.closest('.card-menu-btn') || e.target.closest('.rail-menu') || e.target.closest('.card-open-link')) {
            return;
          }
          const href = card.getAttribute('data-href');
          if (href) window.location.href = href;
        });
      });
      
      // Menu button click
      container.querySelectorAll('.card-menu-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const card = btn.closest('.card');
          if (!card) return;
          
          if (menuOpen && activeMenuCard === card) {
            closeAllMenus();
          } else {
            await openMenu(btn, card);
          }
        });
      });
      
      // Menu item click
      container.querySelectorAll('.rail-menu-item[data-action="save"]').forEach(item => {
        item.addEventListener('click', async (e) => {
          e.stopPropagation();
          const card = item.closest('.card');
          if (!card) return;
          
          const mediaType = card.getAttribute('data-media-type');
          const itemId = card.getAttribute('data-item-id');
          const listType = item.getAttribute('data-list');
          const title = card.getAttribute('data-title');
          const subtitle = card.getAttribute('data-subtitle');
          const image = card.getAttribute('data-image');
          
          const success = await saveToList(mediaType, itemId, listType, {
            title,
            subtitle,
            image
          });
          
          if (success) {
            // Update menu state
            const saved = await getListStatus(mediaType, itemId);
            const menu = item.closest('.rail-menu');
            if (menu) {
              menu.querySelectorAll('.rail-menu-item[data-action="save"]').forEach(btn => {
                const type = btn.getAttribute('data-list');
                const isSaved = saved.has(type);
                btn.classList.toggle('saved', isSaved);
                btn.querySelector('.rail-menu-state').textContent = isSaved ? 'Saved' : 'Add';
              });
            }
          }
          
          closeAllMenus();
        });
      });
      
      // Custom lists menu item
      container.querySelectorAll('.rail-menu-item[data-action="custom"]').forEach(item => {
        item.addEventListener('click', (e) => {
          e.stopPropagation();
          const card = item.closest('.card');
          if (!card) return;
          
          const mediaType = card.getAttribute('data-media-type');
          const itemId = card.getAttribute('data-item-id');
          const title = card.getAttribute('data-title');
          const subtitle = card.getAttribute('data-subtitle');
          const image = card.getAttribute('data-image');
          
          closeAllMenus();
          openCustomListsModal(mediaType, itemId, title, subtitle, image);
        });
      });
    }

    // Render rails
    function renderRails() {
      // Sample data - replace with actual API calls
      const sampleMovies = [
        { id: '1', title: 'Dune: Part Two', year: '2024', image: 'https://image.tmdb.org/t/p/w500/8b8R8l88Qje9dn9OE8PY05Nxl1X.jpg' },
        { id: '2', title: 'Oppenheimer', year: '2023', image: 'https://image.tmdb.org/t/p/w500/8Gxv8gSFCU0XGDykEGv7zR1n2ua.jpg' },
        { id: '3', title: 'Poor Things', year: '2023', image: 'https://image.tmdb.org/t/p/w500/kCGlIMHnOm8JPXq3rXM6c5wMxcT.jpg' }
      ];
      
      const rails = [
        { id: 'moviesRail', type: 'movie', items: sampleMovies },
        { id: 'tvRail', type: 'tv', items: sampleMovies },
        { id: 'gamesRail', type: 'game', items: sampleMovies },
        { id: 'booksRail', type: 'book', items: sampleMovies },
        { id: 'musicRail', type: 'music', items: sampleMovies },
        { id: 'restaurantsRail', type: 'restaurant', items: sampleMovies },
        { id: 'unifiedRail', type: 'mixed', items: [...sampleMovies, ...sampleMovies] }
      ];
      
      rails.forEach(rail => {
        const element = document.getElementById(rail.id);
        if (!element) return;
        
        element.innerHTML = rail.items.map((item, index) => {
          const icon = rail.type === 'movie' ? 'fa-film' :
                      rail.type === 'tv' ? 'fa-tv' :
                      rail.type === 'game' ? 'fa-gamepad' :
                      rail.type === 'book' ? 'fa-book' :
                      rail.type === 'music' ? 'fa-music' :
                      rail.type === 'restaurant' ? 'fa-utensils' : 'fa-star';
          
          return `
            <article class="card" 
              data-href="${rail.type}.html?id=${item.id}"
              data-media-type="${rail.type}"
              data-item-id="${item.id}"
              data-title="${item.title}"
              data-subtitle="${item.year || rail.type}"
              data-image="${item.image || ''}">
              <div class="card-media ${rail.type === 'restaurant' ? 'restaurant-composite' : ''}">
                ${item.image ? `<img src="${item.image}" alt="${item.title}" loading="lazy">` : '<i class="fa-solid fa-image"></i>'}
              </div>
              <div class="card-meta">
                <span class="card-type"><i class="fa-solid ${icon}"></i> ${rail.type}</span>
                <div class="card-meta-top">
                  <p class="card-name">${item.title}</p>
                  <div class="card-menu-wrap">
                    <button class="card-menu-btn"><i class="fas fa-ellipsis-v"></i></button>
                    <div class="rail-menu">
                      <div class="rail-menu-title">Add to list</div>
                      <button class="rail-menu-item" data-action="save" data-list="favorites">
                        <span class="rail-menu-item-main"><i class="fas fa-heart"></i> Favorites</span>
                        <span class="rail-menu-state">Add</span>
                      </button>
                      <button class="rail-menu-item" data-action="save" data-list="watchlist">
                        <span class="rail-menu-item-main"><i class="fas fa-bookmark"></i> Watchlist</span>
                        <span class="rail-menu-state">Add</span>
                      </button>
                      <button class="rail-menu-item" data-action="save" data-list="watched">
                        <span class="rail-menu-item-main"><i class="fas fa-eye"></i> Watched</span>
                        <span class="rail-menu-state">Add</span>
                      </button>
                      <button class="rail-menu-item" data-action="custom">
                        <span class="rail-menu-item-main"><i class="fas fa-list"></i> Custom Lists</span>
                        <span class="rail-menu-state">Open</span>
                      </button>
                    </div>
                  </div>
                </div>
                <p class="card-sub">${item.year || rail.type}</p>
              </div>
            </article>
          `;
        }).join('');
        
        setupCardInteractions(element);
      });
    }

    // Spotlight
    function setupSpotlight() {
      spotlightItems = [
        {
          type: 'movie',
          title: 'Dune: Part Two',
          summary: 'The saga continues as Paul Atreides unites with Chani and the Fremen while seeking revenge against the conspirators who destroyed his family.',
          image: 'https://image.tmdb.org/t/p/w1280/8b8R8l88Qje9dn9OE8PY05Nxl1X.jpg',
          backdrop: 'https://image.tmdb.org/t/p/w1280/1pdfLvkbY9ohJlCjQH2CZjjYVvJ.jpg'
        },
        {
          type: 'tv',
          title: 'Shōgun',
          summary: 'Set in feudal Japan, a British sailor is shipwrecked and becomes entangled in the political machinations of two powerful warlords.',
          image: 'https://image.tmdb.org/t/p/w500/7O4iVfOMQmdCSxhOg1WnzG1AgFm.jpg',
          backdrop: 'https://image.tmdb.org/t/p/w1280/7I6VtP8pHp9iUR4vH4pP6kKq9zF.jpg'
        },
        {
          type: 'game',
          title: 'Final Fantasy VII Rebirth',
          summary: 'Cloud and his friends escape the city of Midgar and venture into the wide world, pursuing Sephiroth across the planet.',
          image: 'https://image.api.playstation.com/vulcan/ap/rnd/202309/1312/1f8c5b6c3a4b5c6d7e8f9a0b1c2d3e4f.jpg',
          backdrop: 'https://image.api.playstation.com/vulcan/ap/rnd/202309/1312/9a8b7c6d5e4f3a2b1c0d9e8f7a6b5c4d.jpg'
        }
      ];
      
      let index = 0;
      
      function showSpotlight(i) {
        const item = spotlightItems[i];
        document.getElementById('spotlightTitle').textContent = item.title;
        document.getElementById('spotlightSummary').textContent = item.summary;
        document.getElementById('spotlightKicker').textContent = `${item.type} Spotlight`;
        document.getElementById('spotlightBackground').style.backgroundImage = `linear-gradient(120deg, rgba(8,14,31,0.7), rgba(10,19,39,0.42)), url("${item.backdrop}")`;
        document.getElementById('spotlightImage').src = item.image;
        document.getElementById('spotlightOpenBtn').href = `${item.type}.html`;
        
        document.querySelectorAll('.spotlight-dot').forEach((dot, idx) => {
          dot.classList.toggle('active', idx === i);
        });
      }
      
      document.getElementById('spotlightDots').innerHTML = spotlightItems.map((_, i) => 
        `<button class="spotlight-dot${i === 0 ? ' active' : ''}" data-index="${i}"></button>`
      ).join('');
      
      document.querySelectorAll('.spotlight-dot').forEach(dot => {
        dot.addEventListener('click', () => {
          index = parseInt(dot.dataset.index);
          showSpotlight(index);
          resetSpotlightTimer();
        });
      });
      
      document.getElementById('spotlightNextBtn').addEventListener('click', () => {
        index = (index + 1) % spotlightItems.length;
        showSpotlight(index);
        resetSpotlightTimer();
      });
      
      function resetSpotlightTimer() {
        if (spotlightTimer) clearInterval(spotlightTimer);
        spotlightTimer = setInterval(() => {
          index = (index + 1) % spotlightItems.length;
          showSpotlight(index);
        }, 5000);
      }
      
      resetSpotlightTimer();
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
      await initSupabase();
      await updateAuthUI();
      
      renderRails();
      setupSpotlight();
      
      // Setup auth
      supabase?.auth.onAuthStateChange(() => {
        updateAuthUI();
      });
      
      // Modal close
      document.getElementById('closeHomeListsBtn').addEventListener('click', () => {
        document.getElementById('homeListsModal').classList.remove('active');
      });
      
      document.getElementById('homeListsModal').addEventListener('click', (e) => {
        if (e.target === document.getElementById('homeListsModal')) {
          document.getElementById('homeListsModal').classList.remove('active');
        }
      });
      
      // Create list
      document.getElementById('createHomeListBtn').addEventListener('click', async () => {
        const input = document.getElementById('newHomeListName');
        const name = input.value.trim();
        if (!name) return;
        
        const icon = document.querySelector('#homeListIconOptions .icon-option.selected')?.getAttribute('data-icon') || 'fas fa-list';
        
        const newList = await createCustomList(customListState.mediaType, name, icon);
        if (newList) {
          customListState.customLists.unshift(newList);
          renderCustomListsModal();
          input.value = '';
        }
      });
      
      // Icon selection
      document.querySelectorAll('#homeListIconOptions .icon-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('#homeListIconOptions .icon-option').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
        });
      });
      
      // Backdrop click
      document.getElementById('railMenuBackdrop').addEventListener('click', closeAllMenus);
      
      // Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeAllMenus();
          document.getElementById('homeListsModal').classList.remove('active');
        }
      });
      
      // Pause spotlight when tab not visible
      document.addEventListener('visibilitychange', () => {
        if (document.hidden) {
          if (spotlightTimer) clearInterval(spotlightTimer);
        } else {
          if (spotlightTimer) {
            clearInterval(spotlightTimer);
            spotlightTimer = setInterval(() => {
              index = (index + 1) % spotlightItems.length;
              showSpotlight(index);
            }, 5000);
          }
        }
      });
    });
  </script>
</body>
</html>