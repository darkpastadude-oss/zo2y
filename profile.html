<script>
  const supabase = supabase.createClient(
    "https://gfkhjbztayjyojsgdpgk.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdma2hqYnp0YXlqeW9qc2dkcGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTYyNjQsImV4cCI6MjA3NTY3MjI2NH0.WUb2yDAwCeokdpWCPeH13FE8NhWF6G8e6ivTsgu6b2s"
  );

  const icons = ['⭐', '🔥', '⚡', '🌙', '🎯', '💎', '🌀', '🐉', '🚀', '💥'];
  document.getElementById("avatar").textContent = icons[Math.floor(Math.random() * icons.length)];

  async function loadProfile() {
    const { data: { user } } = await supabase.auth.getUser();
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    // fetch username from user_profiles
    const { data: profile, error } = await supabase
      .from('user_profiles')
      .select('username, bio')
      .eq('id', user.id)
      .single();

    if (error || !profile) {
      console.log("No profile found, showing fallback");
      document.getElementById("username").textContent = user.email.split("@")[0];
    } else {
      document.getElementById("username").textContent = profile.username || user.email.split("@")[0];
      if(profile.bio) document.getElementById("bio").textContent = profile.bio;
    }
  }

  async function logout() {
    await supabase.auth.signOut();
    window.location.href = "index.html";
  }

  function editProfile() {
    alert("Coming soon — custom bio & avatar update 🔧");
  }

  function addFriend() {
    alert("Friend system coming soon 👥");
  }

  function viewLists() {
    alert("Your saved spots and lists — in progress 🗺️");
  }

  loadProfile();
</script>
